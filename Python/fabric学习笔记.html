<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>fabric学习笔记 - Wiki · Tsong khapa</title>
    <meta name="keywords" content="simiki, wiki, python, simple"/>
    <meta name="description" content="Tanky Woo's personal wiki, powered by vim and markdown. Focus on Python, C/C++, Linux, Ops-Dev, Gentoo, and so on."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#Python">Python</a>&nbsp;&#187;&nbsp;fabric学习笔记
    <span class="updated">Page Updated&nbsp;
      2015-05-07 21:53
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">fabric学习笔记</div>

  <p>安装神马的就不多说了，直接开练~</p>
<h2 id="_1">文档：</h2>
<p>http://docs.fabfile.org/en/1.6/</p>
<h2 id="_2">任务一：</h2>
<p>new一个fabfile.py</p>
<div class="hlcode"><pre><span class="n">def</span> <span class="n">hello</span><span class="p">()</span><span class="o">:</span>
    <span class="n">print</span><span class="p">(</span><span class="s">&quot;Hello world!&quot;</span><span class="p">)</span>
</pre></div>


<p>执行：</p>
<div class="hlcode"><pre><span class="err">╭─@</span><span class="n">Flowerowl</span><span class="p">.</span><span class="n">local</span> <span class="o">~/</span><span class="n">z</span><span class="o">/</span><span class="n">pj</span><span class="o">/</span><span class="n">demos</span>
<span class="err">╰─</span> <span class="n">fab</span> <span class="n">hello</span>
<span class="n">hello</span><span class="o">~~</span>
</pre></div>


<h2 id="_3">任务二：</h2>
<p>新建一个test.py</p>
<div class="hlcode"><pre><span class="n">def</span> <span class="n">hello</span><span class="p">()</span><span class="o">:</span>
    <span class="n">print</span><span class="p">(</span><span class="s">&quot;Hello world!&quot;</span><span class="p">)</span>
</pre></div>


<p>执行：</p>
<div class="hlcode"><pre><span class="err">╭─@</span><span class="n">Flowerowl</span><span class="p">.</span><span class="n">local</span> <span class="o">~/</span><span class="n">z</span><span class="o">/</span><span class="n">pj</span><span class="o">/</span><span class="n">demos</span>
<span class="err">╰─</span> <span class="n">fab</span> <span class="o">-</span><span class="n">f</span> <span class="n">test</span><span class="p">.</span><span class="n">py</span>  <span class="n">hello</span>                                                  <span class="mi">127</span> <span class="err">↵</span>
<span class="n">hello</span><span class="o">~~</span>

<span class="n">Done</span><span class="p">.</span>
</pre></div>


<h2 id="_4">任务三：</h2>
<div class="hlcode"><pre><span class="n">def</span> <span class="n">hello</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span><span class="o">:</span>
    <span class="n">print</span><span class="p">(</span><span class="s">&quot;%s = %s!&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
</pre></div>


<p>执行：</p>
<div class="hlcode"><pre><span class="err">╭─@</span><span class="n">Flowerowl</span><span class="p">.</span><span class="n">local</span> <span class="o">~/</span><span class="n">z</span><span class="o">/</span><span class="n">pj</span><span class="o">/</span><span class="n">demos</span>
<span class="err">╰─</span> <span class="n">fab</span> <span class="n">hello</span><span class="o">:</span><span class="n">name</span><span class="o">=</span><span class="n">yuzhe</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="mi">21</span>
<span class="n">yuzhe</span> <span class="o">=</span> <span class="mi">21</span><span class="o">!</span>
</pre></div>


<h2 id="_5">任务四：</h2>
<div class="hlcode"><pre><span class="nt">from</span> <span class="nt">fabric</span><span class="nc">.api</span> <span class="nt">import</span> <span class="nt">local</span>

<span class="nt">def</span> <span class="nt">lsfab</span><span class="o">():</span>
    <span class="nt">local</span><span class="o">(</span><span class="s1">&#39;ls&#39;</span><span class="o">)</span>
</pre></div>


<p>执行：</p>
<div class="hlcode"><pre><span class="err">╭─@</span><span class="n">Flowerowl</span><span class="p">.</span><span class="n">local</span> <span class="o">~/</span><span class="n">z</span><span class="o">/</span><span class="n">pj</span><span class="o">/</span><span class="n">demos</span>
<span class="err">╰─</span> <span class="n">fab</span> <span class="n">lsfab</span>                                                                <span class="mi">1</span> <span class="err">↵</span>
<span class="p">[</span><span class="n">localhost</span><span class="p">]</span> <span class="n">local</span><span class="o">:</span> <span class="n">ls</span>
<span class="n">array_list</span><span class="p">.</span><span class="n">py</span>       <span class="n">fabfile</span><span class="p">.</span><span class="n">pyc</span>     <span class="n">numpy_demos</span><span class="p">.</span><span class="n">py</span>
<span class="n">decorator</span><span class="p">.</span><span class="n">py</span>        <span class="n">main_mylocker</span><span class="p">.</span><span class="n">py</span>    <span class="n">path</span><span class="p">.</span><span class="n">py</span>
<span class="n">django</span><span class="p">.</span><span class="n">py</span>       <span class="n">metaclass</span><span class="p">.</span><span class="n">py</span>        <span class="n">stdin</span><span class="p">.</span><span class="n">py</span>
<span class="n">django</span><span class="p">.</span><span class="n">pyc</span>      <span class="n">mylocker</span><span class="p">.</span><span class="n">py</span>     <span class="n">test</span><span class="p">.</span><span class="n">py</span>
<span class="n">fabfile</span><span class="p">.</span><span class="n">py</span>      <span class="n">mylocker</span><span class="p">.</span><span class="n">pyc</span>        <span class="n">test</span><span class="p">.</span><span class="n">pyc</span>

<span class="n">Done</span><span class="p">.</span>
</pre></div>


<h2 id="_6">任务五：</h2>
<p>两台机器：10.1.6.186、10.1.6.159。fabric部署在10.1.6.186上面。</p>
<p>执行一个简单的task任务，显示两台机器的/home/guol/目录下的文件</p>
<p>在fabric中可以将主机名、用户名、密码等信息写在fabfile中，但是不推荐将明文写在代码中，还是最好使用SSH的Key来认证</p>
<div class="hlcode"><pre><span class="n">from</span> <span class="n">fabric</span><span class="p">.</span><span class="n">api</span> <span class="n">import</span> <span class="o">*</span>
<span class="n">from</span> <span class="n">fabric</span><span class="p">.</span><span class="n">context_managers</span> <span class="n">import</span> <span class="o">*</span>

<span class="n">env</span><span class="p">.</span><span class="n">hosts</span><span class="o">=</span><span class="p">[</span><span class="err">&#39;</span><span class="mf">10.1.6.186</span><span class="sc">&#39;,&#39;</span><span class="mf">10.1.6.159</span><span class="err">&#39;</span><span class="p">]</span>
<span class="n">env</span><span class="p">.</span><span class="n">password</span><span class="o">=</span><span class="err">&#39;</span><span class="n">xxxxxx</span><span class="err">&#39;</span>

<span class="n">def</span> <span class="n">task1</span><span class="p">()</span><span class="o">:</span>
    <span class="n">with</span> <span class="n">cd</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">guol</span><span class="err">&#39;</span><span class="p">)</span><span class="o">:</span>
        <span class="n">run</span><span class="p">(</span><span class="err">&#39;</span><span class="n">ls</span> <span class="o">-</span><span class="n">l</span><span class="err">&#39;</span><span class="p">)</span>

<span class="cp">##结果</span>
<span class="n">root</span><span class="err">@</span><span class="n">vm11</span><span class="o">:/</span><span class="n">tmp</span><span class="err">#</span> <span class="n">fab</span> <span class="n">task1</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">Executing</span> <span class="n">task</span> <span class="err">&#39;</span><span class="n">task1</span><span class="err">&#39;</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">run</span><span class="o">:</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span> <span class="n">total</span> <span class="mi">0</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">0</span> <span class="n">Dec</span> <span class="mi">21</span> <span class="mi">13</span><span class="o">:</span><span class="mi">32</span> <span class="mi">186</span><span class="o">-</span><span class="n">local</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span>

<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">Executing</span> <span class="n">task</span> <span class="err">&#39;</span><span class="n">task1</span><span class="err">&#39;</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">run</span><span class="o">:</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span> <span class="n">total</span> <span class="mi">0</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">0</span> <span class="n">Dec</span> <span class="mi">21</span> <span class="mi">13</span><span class="o">:</span><span class="mi">32</span> <span class="mi">159</span><span class="o">-</span><span class="n">remote</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span>


<span class="n">Done</span><span class="p">.</span>
<span class="n">Disconnecting</span> <span class="n">from</span> <span class="mf">10.1.6.159</span><span class="p">...</span> <span class="n">done</span><span class="p">.</span>
<span class="n">Disconnecting</span> <span class="n">from</span> <span class="mf">10.1.6.186</span><span class="p">...</span> <span class="n">done</span><span class="p">.</span>
</pre></div>


<h2 id="_7">任务六：</h2>
<p>执行和1相同的任务，不过排除掉10.1.6.159这台机器</p>
<div class="hlcode"><pre><span class="n">from</span> <span class="n">fabric</span><span class="p">.</span><span class="n">api</span> <span class="n">import</span> <span class="o">*</span>
<span class="n">from</span> <span class="n">fabric</span><span class="p">.</span><span class="n">context_managers</span> <span class="n">import</span> <span class="o">*</span>

<span class="n">env</span><span class="p">.</span><span class="n">hosts</span><span class="o">=</span><span class="p">[</span><span class="err">&#39;</span><span class="mf">10.1.6.186</span><span class="sc">&#39;,&#39;</span><span class="mf">10.1.6.159</span><span class="err">&#39;</span><span class="p">]</span>
<span class="n">env</span><span class="p">.</span><span class="n">password</span><span class="o">=</span><span class="err">&#39;</span><span class="n">xxxxxx</span><span class="err">&#39;</span>
<span class="n">env</span><span class="p">.</span><span class="n">exclude_hosts</span><span class="o">=</span><span class="p">[</span><span class="err">&#39;</span><span class="mf">10.1.6.159</span><span class="err">&#39;</span><span class="p">]</span>

<span class="n">def</span> <span class="n">task1</span><span class="p">()</span><span class="o">:</span>
    <span class="n">with</span> <span class="n">cd</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">guol</span><span class="err">&#39;</span><span class="p">)</span><span class="o">:</span>
        <span class="n">run</span><span class="p">(</span><span class="err">&#39;</span><span class="n">ls</span> <span class="o">-</span><span class="n">l</span><span class="err">&#39;</span><span class="p">)</span>

<span class="cp">##执行</span>
<span class="n">root</span><span class="err">@</span><span class="n">vm11</span><span class="o">:/</span><span class="n">tmp</span><span class="err">#</span> <span class="n">fab</span> <span class="n">task1</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">Executing</span> <span class="n">task</span> <span class="err">&#39;</span><span class="n">task1</span><span class="err">&#39;</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">run</span><span class="o">:</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span> <span class="n">total</span> <span class="mi">0</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">0</span> <span class="n">Dec</span> <span class="mi">21</span> <span class="mi">13</span><span class="o">:</span><span class="mi">32</span> <span class="mi">186</span><span class="o">-</span><span class="n">local</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span>


<span class="n">Done</span><span class="p">.</span>
<span class="n">Disconnecting</span> <span class="n">from</span> <span class="mf">10.1.6.186</span><span class="p">...</span> <span class="n">done</span><span class="p">.</span>
</pre></div>


<h2 id="_8">任务七：</h2>
<p>执行和2相同任务，再增加一个task2，并且把taskN伪装成meta任务执行</p>
<div class="hlcode"><pre><span class="n">from</span> <span class="n">fabric</span><span class="p">.</span><span class="n">api</span> <span class="n">import</span> <span class="o">*</span>
<span class="n">from</span> <span class="n">fabric</span><span class="p">.</span><span class="n">colors</span> <span class="n">import</span> <span class="o">*</span>
<span class="n">from</span> <span class="n">fabric</span><span class="p">.</span><span class="n">context_managers</span> <span class="n">import</span> <span class="o">*</span>

<span class="n">env</span><span class="p">.</span><span class="n">hosts</span><span class="o">=</span><span class="p">[</span><span class="err">&#39;</span><span class="mf">10.1.6.186</span><span class="sc">&#39;,&#39;</span><span class="mf">10.1.6.159</span><span class="err">&#39;</span><span class="p">]</span>
<span class="n">env</span><span class="p">.</span><span class="n">password</span><span class="o">=</span><span class="err">&#39;</span><span class="n">xxxxxx</span><span class="err">&#39;</span>
<span class="n">env</span><span class="p">.</span><span class="n">exclude_hosts</span><span class="o">=</span><span class="p">[</span><span class="err">&#39;</span><span class="mf">10.1.6.159</span><span class="err">&#39;</span><span class="p">]</span>


<span class="n">def</span> <span class="n">task1</span><span class="p">()</span><span class="o">:</span>
    <span class="n">with</span> <span class="n">cd</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">guol</span><span class="err">&#39;</span><span class="p">)</span><span class="o">:</span>
        <span class="n">run</span><span class="p">(</span><span class="err">&#39;</span><span class="n">ls</span> <span class="o">-</span><span class="n">l</span><span class="err">&#39;</span><span class="p">)</span>

<span class="n">def</span> <span class="n">task2</span><span class="p">()</span><span class="o">:</span>
    <span class="n">print</span><span class="p">(</span><span class="n">green</span><span class="p">(</span><span class="s">&quot;I&#39;m fabric&quot;</span><span class="p">))</span>

<span class="n">def</span> <span class="n">deploy</span><span class="p">()</span><span class="o">:</span>
    <span class="n">execute</span><span class="p">(</span><span class="n">task1</span><span class="p">)</span>
    <span class="n">execute</span><span class="p">(</span><span class="n">task2</span><span class="p">)</span>

<span class="cp">##执行</span>
<span class="n">root</span><span class="err">@</span><span class="n">vm11</span><span class="o">:/</span><span class="n">tmp</span><span class="err">#</span> <span class="n">fab</span> <span class="n">deploy</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">Executing</span> <span class="n">task</span> <span class="err">&#39;</span><span class="n">deploy</span><span class="err">&#39;</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">Executing</span> <span class="n">task</span> <span class="err">&#39;</span><span class="n">task1</span><span class="err">&#39;</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">run</span><span class="o">:</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span> <span class="n">total</span> <span class="mi">0</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">0</span> <span class="n">Dec</span> <span class="mi">21</span> <span class="mi">13</span><span class="o">:</span><span class="mi">32</span> <span class="mi">186</span><span class="o">-</span><span class="n">local</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span>

<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">Executing</span> <span class="n">task</span> <span class="err">&#39;</span><span class="n">task2</span><span class="err">&#39;</span>
<span class="n">I</span><span class="err">&#39;</span><span class="n">m</span> <span class="n">fabric</span>

<span class="n">Done</span><span class="p">.</span>
<span class="n">Disconnecting</span> <span class="n">from</span> <span class="mf">10.1.6.186</span><span class="p">...</span> <span class="n">done</span><span class="p">.</span>
</pre></div>


<h2 id="_9">任务八：</h2>
<p>不同的机器执行不同的task</p>
<div class="hlcode"><pre><span class="n">from</span> <span class="n">fabric</span><span class="p">.</span><span class="n">api</span> <span class="n">import</span> <span class="o">*</span>
<span class="n">from</span> <span class="n">fabric</span><span class="p">.</span><span class="n">colors</span> <span class="n">import</span> <span class="o">*</span>
<span class="n">from</span> <span class="n">fabric</span><span class="p">.</span><span class="n">context_managers</span> <span class="n">import</span> <span class="o">*</span>

<span class="n">env</span><span class="p">.</span><span class="n">roledefs</span><span class="o">=</span><span class="p">{</span><span class="err">&#39;</span><span class="n">web1</span><span class="err">&#39;</span><span class="o">:</span><span class="p">[</span><span class="err">&#39;</span><span class="mf">10.1.6.186</span><span class="err">&#39;</span><span class="p">],</span><span class="err">&#39;</span><span class="n">web2</span><span class="err">&#39;</span><span class="o">:</span><span class="p">[</span><span class="err">&#39;</span><span class="mf">10.1.6.159</span><span class="err">&#39;</span><span class="p">]}</span>
<span class="n">env</span><span class="p">.</span><span class="n">password</span><span class="o">=</span><span class="err">&#39;</span><span class="n">xxxxxx</span><span class="err">&#39;</span>

<span class="err">@</span><span class="n">roles</span><span class="p">(</span><span class="err">&#39;</span><span class="n">web1</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">task1</span><span class="p">()</span><span class="o">:</span>
    <span class="n">with</span> <span class="n">cd</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">guol</span><span class="err">&#39;</span><span class="p">)</span><span class="o">:</span>
        <span class="n">run</span><span class="p">(</span><span class="err">&#39;</span><span class="n">ls</span> <span class="o">-</span><span class="n">l</span><span class="err">&#39;</span><span class="p">)</span>
<span class="err">@</span><span class="n">roles</span><span class="p">(</span><span class="err">&#39;</span><span class="n">web2</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">task2</span><span class="p">()</span><span class="o">:</span>
    <span class="n">print</span><span class="p">(</span><span class="n">green</span><span class="p">(</span><span class="s">&quot;I&#39;m fabric&quot;</span><span class="p">))</span>

<span class="n">def</span> <span class="n">deploy</span><span class="p">()</span><span class="o">:</span>
    <span class="n">execute</span><span class="p">(</span><span class="n">task1</span><span class="p">)</span>
    <span class="n">execute</span><span class="p">(</span><span class="n">task2</span><span class="p">)</span>
<span class="cp">##执行</span>
<span class="n">root</span><span class="err">@</span><span class="n">vm11</span><span class="o">:/</span><span class="n">tmp</span><span class="err">#</span> <span class="n">fab</span> <span class="n">deploy</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">Executing</span> <span class="n">task</span> <span class="err">&#39;</span><span class="n">task1</span><span class="err">&#39;</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">run</span><span class="o">:</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span> <span class="n">total</span> <span class="mi">0</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">0</span> <span class="n">Dec</span> <span class="mi">21</span> <span class="mi">13</span><span class="o">:</span><span class="mi">32</span> <span class="mi">186</span><span class="o">-</span><span class="n">local</span>
<span class="p">[</span><span class="mf">10.1.6.186</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span>

<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">Executing</span> <span class="n">task</span> <span class="err">&#39;</span><span class="n">task2</span><span class="err">&#39;</span>
<span class="n">I</span><span class="err">&#39;</span><span class="n">m</span> <span class="n">fabric</span>

<span class="n">Done</span><span class="p">.</span>
<span class="n">Disconnecting</span> <span class="n">from</span> <span class="mf">10.1.6.186</span><span class="p">...</span> <span class="n">done</span><span class="p">.</span>
</pre></div>


<h2 id="_10">任务九：</h2>
<p>把159的/home/guol/159-remote拉取到186的 /home/guol/目录下</p>
<div class="hlcode"><pre>from fabric.api import <span class="o">*</span>
from fabric.colors import <span class="o">*</span>
from fabric.context_managers import <span class="o">*</span>
env.hosts<span class="o">=</span><span class="p">[</span><span class="s">&#39;10.1.6.159&#39;</span><span class="p">]</span>
env.password<span class="o">=</span><span class="s">&#39;xxxxxx&#39;</span>

def task1<span class="p">()</span><span class="o">:</span>
    print<span class="p">(</span>green<span class="p">(</span><span class="s">&quot;I&#39;m 186 /home/guol/&quot;</span><span class="p">))</span>
    local<span class="p">(</span><span class="s">&#39;ls -l /home/guol&#39;</span><span class="p">)</span>
def task2<span class="p">()</span><span class="o">:</span>
    print<span class="p">(</span>green<span class="p">(</span><span class="s">&quot;I&#39;m get 159&#39;s 159-remote file to 186&quot;</span><span class="p">))</span>
    get<span class="p">(</span><span class="s">&#39;/home/guol/159-remote&#39;</span><span class="p">,</span><span class="s">&#39;/home/guol&#39;</span><span class="p">)</span>
    print<span class="p">(</span>yellow<span class="p">(</span><span class="s">&quot;I&#39;m 186 /home/guol/&quot;</span><span class="p">))</span>
    local<span class="p">(</span><span class="s">&#39;ls -l /home/guol&#39;</span><span class="p">)</span>

def deploy<span class="p">()</span><span class="o">:</span>
    execute<span class="p">(</span>task1<span class="p">)</span>
    execute<span class="p">(</span>task2<span class="p">)</span>

<span class="c1">##执行</span>
root<span class="o">@</span>vm11<span class="o">:/</span>tmp<span class="c1"># fab deploy</span>
<span class="p">[</span><span class="m">10.1.6.159</span><span class="p">]</span> Executing task <span class="s">&#39;deploy&#39;</span>
<span class="p">[</span><span class="m">10.1.6.159</span><span class="p">]</span> Executing task <span class="s">&#39;task1&#39;</span>
I<span class="s">&#39;m 186 /home/guol/</span>
<span class="s">[localhost] local: ls -l /home/guol</span>
<span class="s">total 0</span>
<span class="s">-rw-r--r-- 1 root root 0 Dec 21 13:32 186-local</span>
<span class="s">[10.1.6.159] Executing task &#39;</span>task2<span class="s">&#39;</span>
<span class="s">I&#39;</span>m get <span class="m">159</span><span class="s">&#39;s 159-remote file to 186</span>
<span class="s">[10.1.6.159] download: /home/guol/159-remote &lt;- /home/guol/159-remote</span>
<span class="s">I&#39;</span>m <span class="m">186</span> <span class="o">/</span>home<span class="o">/</span>guol<span class="o">/</span>
<span class="p">[</span>localhost<span class="p">]</span> local<span class="o">:</span> ls <span class="o">-</span>l <span class="o">/</span>home<span class="o">/</span>guol
total <span class="m">0</span>
<span class="o">-</span>rw<span class="o">-</span>r<span class="o">--</span>r<span class="o">--</span> <span class="m">1</span> root root <span class="m">0</span> Dec <span class="m">21</span> <span class="m">14</span><span class="o">:</span><span class="m">28</span> <span class="m">159</span><span class="o">-</span>remote
<span class="o">-</span>rw<span class="o">-</span>r<span class="o">--</span>r<span class="o">--</span> <span class="m">1</span> root root <span class="m">0</span> Dec <span class="m">21</span> <span class="m">13</span><span class="o">:</span><span class="m">32</span> <span class="m">186</span><span class="o">-</span>local

Done.
Disconnecting from <span class="m">10.1.6.159</span><span class="kc">...</span> done.
</pre></div>


<h2 id="_11">任务十：</h2>
<p>把186的/home/guol/ 186-local推送到159的 /home/guol/目录下</p>
<div class="hlcode"><pre><span class="n">from</span> <span class="n">fabric</span><span class="p">.</span><span class="n">api</span> <span class="n">import</span> <span class="o">*</span>
<span class="n">from</span> <span class="n">fabric</span><span class="p">.</span><span class="n">colors</span> <span class="n">import</span> <span class="o">*</span>
<span class="n">from</span> <span class="n">fabric</span><span class="p">.</span><span class="n">context_managers</span> <span class="n">import</span> <span class="o">*</span>
<span class="n">env</span><span class="p">.</span><span class="n">hosts</span><span class="o">=</span><span class="p">[</span><span class="err">&#39;</span><span class="mf">10.1.6.159</span><span class="err">&#39;</span><span class="p">]</span>
<span class="n">env</span><span class="p">.</span><span class="n">password</span><span class="o">=</span><span class="err">&#39;</span><span class="n">xxxxxx</span><span class="err">&#39;</span>

<span class="n">def</span> <span class="n">task1</span><span class="p">()</span><span class="o">:</span>
    <span class="n">print</span><span class="p">(</span><span class="n">green</span><span class="p">(</span><span class="s">&quot;I&#39;m 159 /home/guol/&quot;</span><span class="p">))</span>
    <span class="n">with</span> <span class="n">cd</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">guol</span><span class="err">&#39;</span><span class="p">)</span><span class="o">:</span>
        <span class="n">run</span><span class="p">(</span><span class="err">&#39;</span><span class="n">ls</span> <span class="o">-</span><span class="n">l</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">task2</span><span class="p">()</span><span class="o">:</span>
    <span class="n">print</span><span class="p">(</span><span class="n">green</span><span class="p">(</span><span class="s">&quot;I&#39;m put 186&#39;s 186-local file to 159&quot;</span><span class="p">))</span>
    <span class="n">put</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">guol</span><span class="o">/</span><span class="mi">186</span><span class="o">-</span><span class="n">local</span><span class="sc">&#39;,&#39;</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">guol</span><span class="err">&#39;</span><span class="p">)</span>
    <span class="n">print</span><span class="p">(</span><span class="n">yellow</span><span class="p">(</span><span class="s">&quot;I&#39;m 159 /home/guol/&quot;</span><span class="p">))</span>
    <span class="n">with</span> <span class="n">cd</span><span class="p">(</span><span class="err">&#39;</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">guol</span><span class="err">&#39;</span><span class="p">)</span><span class="o">:</span>
        <span class="n">run</span><span class="p">(</span><span class="err">&#39;</span><span class="n">ls</span> <span class="o">-</span><span class="n">l</span><span class="err">&#39;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">deploy</span><span class="p">()</span><span class="o">:</span>
    <span class="n">execute</span><span class="p">(</span><span class="n">task1</span><span class="p">)</span>
    <span class="n">execute</span><span class="p">(</span><span class="n">task2</span><span class="p">)</span>

<span class="cp">##执行</span>
<span class="n">root</span><span class="err">@</span><span class="n">vm11</span><span class="o">:/</span><span class="n">tmp</span><span class="err">#</span> <span class="n">fab</span> <span class="n">deploy</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">Executing</span> <span class="n">task</span> <span class="err">&#39;</span><span class="n">deploy</span><span class="err">&#39;</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">Executing</span> <span class="n">task</span> <span class="err">&#39;</span><span class="n">task1</span><span class="err">&#39;</span>
<span class="n">I</span><span class="err">&#39;</span><span class="n">m</span> <span class="mi">159</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">guol</span><span class="o">/</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">run</span><span class="o">:</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span> <span class="n">total</span> <span class="mi">0</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">0</span> <span class="n">Dec</span> <span class="mi">21</span> <span class="mi">13</span><span class="o">:</span><span class="mi">32</span> <span class="mi">159</span><span class="o">-</span><span class="n">remote</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span>

<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">Executing</span> <span class="n">task</span> <span class="err">&#39;</span><span class="n">task2</span><span class="err">&#39;</span>
<span class="n">I</span><span class="err">&#39;</span><span class="n">m</span> <span class="n">put</span> <span class="mi">186</span><span class="err">&#39;</span><span class="n">s</span> <span class="mi">186</span><span class="o">-</span><span class="n">local</span> <span class="n">file</span> <span class="n">to</span> <span class="mi">159</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">put</span><span class="o">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">guol</span><span class="o">/</span><span class="mi">186</span><span class="o">-</span><span class="n">local</span> <span class="o">-&gt;</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">guol</span><span class="o">/</span><span class="mi">186</span><span class="o">-</span><span class="n">local</span>
<span class="n">I</span><span class="err">&#39;</span><span class="n">m</span> <span class="mi">159</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">guol</span><span class="o">/</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">run</span><span class="o">:</span> <span class="n">ls</span> <span class="o">-</span><span class="n">l</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span> <span class="n">total</span> <span class="mi">0</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">0</span> <span class="n">Dec</span> <span class="mi">21</span> <span class="mi">13</span><span class="o">:</span><span class="mi">32</span> <span class="mi">159</span><span class="o">-</span><span class="n">remote</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span> <span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">0</span> <span class="n">Dec</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">33</span> <span class="mi">186</span><span class="o">-</span><span class="n">local</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">out</span><span class="o">:</span>


<span class="n">Done</span><span class="p">.</span>
<span class="n">Disconnecting</span> <span class="n">from</span> <span class="mf">10.1.6.159</span><span class="p">...</span> <span class="n">done</span><span class="p">.</span>
</pre></div>


<h2 id="_12">任务十一：</h2>
<p>在186上打开一个159的交互式的shell</p>
<div class="hlcode"><pre><span class="n">from</span> <span class="n">fabric</span><span class="p">.</span><span class="n">api</span> <span class="n">import</span> <span class="o">*</span>
<span class="n">from</span> <span class="n">fabric</span><span class="p">.</span><span class="n">colors</span> <span class="n">import</span> <span class="o">*</span>
<span class="n">from</span> <span class="n">fabric</span><span class="p">.</span><span class="n">context_managers</span> <span class="n">import</span> <span class="o">*</span>
<span class="n">env</span><span class="p">.</span><span class="n">hosts</span><span class="o">=</span><span class="p">[</span><span class="err">&#39;</span><span class="mf">10.1.6.159</span><span class="err">&#39;</span><span class="p">]</span>
<span class="n">env</span><span class="p">.</span><span class="n">password</span><span class="o">=</span><span class="err">&#39;</span><span class="n">xxxxxx</span><span class="err">&#39;</span>

<span class="n">def</span> <span class="n">task3</span><span class="p">()</span><span class="o">:</span>
    <span class="n">open_shell</span><span class="p">(</span><span class="s">&quot;ifconfig eth0|grep &#39;10.1.6.159&#39;&quot;</span><span class="p">)</span>
<span class="n">def</span> <span class="n">deploy</span><span class="p">()</span><span class="o">:</span>
     <span class="n">execute</span><span class="p">(</span><span class="n">task3</span><span class="p">)</span>

<span class="cp">##执行</span>
<span class="n">root</span><span class="err">@</span><span class="n">vm11</span><span class="o">:/</span><span class="n">tmp</span><span class="err">#</span> <span class="n">fab</span> <span class="n">deploy</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">Executing</span> <span class="n">task</span> <span class="err">&#39;</span><span class="n">deploy</span><span class="err">&#39;</span>
<span class="p">[</span><span class="mf">10.1.6.159</span><span class="p">]</span> <span class="n">Executing</span> <span class="n">task</span> <span class="err">&#39;</span><span class="n">task3</span><span class="err">&#39;</span>
<span class="n">Welcome</span> <span class="n">to</span> <span class="n">Ubuntu</span> <span class="mf">12.10</span> <span class="p">(</span><span class="n">GNU</span><span class="o">/</span><span class="n">Linux</span> <span class="mf">3.5.0</span><span class="o">-</span><span class="mi">17</span><span class="o">-</span><span class="n">generic</span> <span class="n">x86_64</span><span class="p">)</span>
<span class="n">Last</span> <span class="n">login</span><span class="o">:</span> <span class="n">Fri</span> <span class="n">Dec</span> <span class="mi">21</span> <span class="mi">14</span><span class="o">:</span><span class="mi">39</span><span class="o">:</span><span class="mi">39</span> <span class="mi">2012</span> <span class="n">from</span> <span class="mf">10.1.6.186</span>
<span class="n">ifconfig</span> <span class="n">eth0</span><span class="o">|</span><span class="n">grep</span> <span class="err">&#39;</span><span class="mf">10.1.6.159</span><span class="err">&#39;</span>
<span class="n">root</span><span class="err">@</span><span class="n">vm12</span><span class="o">:~</span><span class="err">#</span> <span class="n">ifconfig</span> <span class="n">eth0</span><span class="o">|</span><span class="n">grep</span> <span class="err">&#39;</span><span class="mf">10.1.6.159</span><span class="err">&#39;</span>
          <span class="n">inet</span> <span class="n">addr</span><span class="o">:</span><span class="mf">10.1.6.159</span>  <span class="n">Bcast</span><span class="o">:</span><span class="mf">10.1.6.255</span>  <span class="n">Mask</span><span class="o">:</span><span class="mf">255.255.255.0</span>
</pre></div>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2020 Tsong khapa.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2020-10-02 22:54:23</p>
      </span>
    </div>

    
    
  </body>
</html>