<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>Grunt：任务自动管理工具 - Wiki · Tsong khapa</title>
    <meta name="keywords" content="simiki, wiki, python, simple"/>
    <meta name="description" content="Tanky Woo's personal wiki, powered by vim and markdown. Focus on Python, C/C++, Linux, Ops-Dev, Gentoo, and so on."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#Node">Node</a>&nbsp;&#187;&nbsp;Grunt：任务自动管理工具
    <span class="updated">Page Updated&nbsp;
      2015-02-25 22:34
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">Grunt：任务自动管理工具</div>

  <p>在Javascript的开发过程中，经常会遇到一些重复性的任务，比如合并文件、压缩代码、检查语法错误、将Sass代码转成CSS代码等等。通常，我们需要使用不同的工具，来完成不同的任务，既重复劳动又非常耗时。Grunt就是为了解决这个问题而发明的工具，可以帮助我们自动管理和运行各种任务。</p>
<p>简单说，Grunt是一个自动任务运行器，会按照预先设定的顺序自动运行一系列的任务。这可以简化工作流程，减轻重复性工作带来的负担。</p>
<h2 id="_1">安装</h2>
<p>Grunt基于Node.js，安装之前要先安装Node.js，然后运行下面的命令。</p>
<div class="hlcode"><pre><span class="n">sudo</span> <span class="n">npm</span> <span class="n">install</span> <span class="n">grunt</span><span class="o">-</span><span class="n">cli</span> <span class="o">-</span><span class="n">g</span>
</pre></div>


<p>grunt-cli表示安装的是grunt的命令行界面，参数g表示全局安装。</p>
<p>Grunt使用模块结构，除了安装命令行界面以外，还要根据需要安装相应的模块。这些模块应该采用局部安装，因为不同项目可能需要同一个模块的不同版本。</p>
<p>首先，在项目的根目录下，创建一个文本文件package.json，指定当前项目所需的模块。下面就是一个例子。</p>
<div class="hlcode"><pre><span class="p">{</span>
  <span class="s">&quot;name&quot;</span><span class="o">:</span> <span class="s">&quot;my-project-name&quot;</span><span class="p">,</span>
  <span class="s">&quot;version&quot;</span><span class="o">:</span> <span class="s">&quot;0.1.0&quot;</span><span class="p">,</span>
  <span class="s">&quot;author&quot;</span><span class="o">:</span> <span class="s">&quot;Your Name&quot;</span><span class="p">,</span>
  <span class="s">&quot;devDependencies&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s">&quot;grunt&quot;</span><span class="o">:</span> <span class="s">&quot;0.x.x&quot;</span><span class="p">,</span>
    <span class="s">&quot;grunt-contrib-jshint&quot;</span><span class="o">:</span> <span class="s">&quot;*&quot;</span><span class="p">,</span>
    <span class="s">&quot;grunt-contrib-concat&quot;</span><span class="o">:</span> <span class="s">&quot;~0.1.1&quot;</span><span class="p">,</span>
    <span class="s">&quot;grunt-contrib-uglify&quot;</span><span class="o">:</span> <span class="s">&quot;~0.1.0&quot;</span><span class="p">,</span>
    <span class="s">&quot;grunt-contrib-watch&quot;</span><span class="o">:</span> <span class="s">&quot;~0.1.4&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>上面这个package.json文件中，除了注明项目的名称和版本以外，还在devDependencies属性中指定了项目依赖的grunt模块和版本：grunt核心模块为最新的0.x.x版，jshint插件为最新版本，concat插件不低于0.1.1版，uglify插件不低于0.1.0版，watch插件不低于0.1.4版。</p>
<p>然后，在项目的根目录下运行下面的命令，这些插件就会被自动安装在node_modules子目录。</p>
<div class="hlcode"><pre><span class="n">npm</span> <span class="n">install</span>
</pre></div>


<p>上面这种方法是针对已有package.json的情况。如果想要自动生成package.json文件，可以使用npm init命令，按照屏幕提示回答所需模块的名称和版本即可。</p>
<div class="hlcode"><pre><span class="n">npm</span> <span class="n">init</span>
</pre></div>


<p>如果已有的package.json文件不包括Grunt模块，可以在直接安装Grunt模块的时候，加上--save-dev参数，该模块就会自动被加入package.json文件。</p>
<div class="hlcode"><pre><span class="nx">npm</span> <span class="nb">install</span> <span class="o">&lt;</span><span class="nx">module</span><span class="o">&gt;</span> <span class="o">--</span><span class="nb">save</span><span class="na">-dev</span>
</pre></div>


<p>比如，对应上面package.json文件指定的模块，需要运行以下npm命令。</p>
<div class="hlcode"><pre><span class="n">npm</span> <span class="n">install</span> <span class="n">grunt</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">dev</span>
<span class="n">npm</span> <span class="n">install</span> <span class="n">grunt</span><span class="o">-</span><span class="n">contrib</span><span class="o">-</span><span class="n">jshint</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">dev</span>
<span class="n">npm</span> <span class="n">install</span> <span class="n">grunt</span><span class="o">-</span><span class="n">contrib</span><span class="o">-</span><span class="n">concat</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">dev</span>
<span class="n">npm</span> <span class="n">install</span> <span class="n">grunt</span><span class="o">-</span><span class="n">contrib</span><span class="o">-</span><span class="n">uglify</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">dev</span>
<span class="n">npm</span> <span class="n">install</span> <span class="n">grunt</span><span class="o">-</span><span class="n">contrib</span><span class="o">-</span><span class="n">watch</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">dev</span>
</pre></div>


<h2 id="gruntfilejs">命令脚本文件Gruntfile.js</h2>
<p>模块安装完以后，下一步在项目的根目录下，新建脚本文件Gruntfile.js。它是grunt的配置文件，就好像package.json是npm的配置文件一样。Gruntfile.js就是一般的Node.js模块的写法。</p>
<div class="hlcode"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">// 配置Grunt各种模块的参数</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span><span class="p">({</span>
    <span class="nx">jshint</span><span class="o">:</span> <span class="p">{</span> <span class="cm">/* jshint的参数 */</span> <span class="p">},</span>
    <span class="nx">concat</span><span class="o">:</span> <span class="p">{</span> <span class="cm">/* concat的参数 */</span> <span class="p">},</span>
    <span class="nx">uglify</span><span class="o">:</span> <span class="p">{</span> <span class="cm">/* uglify的参数 */</span> <span class="p">},</span>
    <span class="nx">watch</span><span class="o">:</span>  <span class="p">{</span> <span class="cm">/* watch的参数 */</span> <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// 从node_modules目录加载模块文件</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-jshint&#39;</span><span class="p">);</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-concat&#39;</span><span class="p">);</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-uglify&#39;</span><span class="p">);</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-watch&#39;</span><span class="p">);</span>

  <span class="c1">// 每行registerTask定义一个任务</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="cp">[</span><span class="s1">&#39;jshint&#39;</span><span class="p">,</span> <span class="s1">&#39;concat&#39;</span><span class="p">,</span> <span class="s1">&#39;uglify&#39;</span><span class="cp">]</span><span class="p">);</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;check&#39;</span><span class="p">,</span> <span class="cp">[</span><span class="s1">&#39;jshint&#39;</span><span class="cp">]</span><span class="p">);</span>

<span class="p">};</span>
</pre></div>


<p>上面的代码用到了grunt代码的三个方法：</p>
<ul>
<li>
<p><strong>grunt.initConfig</strong>：定义各种模块的参数，每一个成员项对应一个同名模块。</p>
</li>
<li>
<p><strong>grunt.loadNpmTasks</strong>：加载完成任务所需的模块。</p>
</li>
<li>
<p><strong>grunt.registerTask</strong>：定义具体的任务。第一个参数为任务名，第二个参数是一个数组，表示该任务需要依次使用的模块。default任务名表示，如果直接输入grunt命令，后面不跟任何参数，这时所调用的模块（该例为jshint，concat和uglify）；该例的check任务则表示使用jshint插件对代码进行语法检查。</p>
</li>
</ul>
<p>上面的代码一共加载了四个模块：jshint（检查语法错误）、concat（合并文件）、uglify（压缩代码）和watch（自动执行）。接下来，有两种使用方法。</p>
<p>（1）命令行执行某个模块，比如</p>
<div class="hlcode"><pre><span class="n">grunt</span> <span class="n">jshint</span>
</pre></div>


<p>上面代码表示运行jshint模块。</p>
<p>（2）命令行执行某个任务。比如</p>
<div class="hlcode"><pre><span class="n">grunt</span> <span class="n">check</span>
</pre></div>


<p>上面代码表示运行check任务。如果运行成功，就会显示“Done, without errors.”。</p>
<p>如果没有给出任务名，只键入grunt，就表示执行默认的default任务。</p>
<h2 id="gruntfilejsgrunt-contrib-cssmin">Gruntfile.js实例：grunt-contrib-cssmin模块</h2>
<p>下面通过cssmin模块，演示如何编写Gruntfile.js文件。cssmin模块的作用是最小化CSS文件。</p>
<p>首先，在项目的根目录下安装该模块。</p>
<div class="hlcode"><pre><span class="n">npm</span> <span class="n">install</span> <span class="n">grunt</span><span class="o">-</span><span class="n">contrib</span><span class="o">-</span><span class="n">cssmin</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">dev</span>
</pre></div>


<p>然后，新建文件Gruntfile.js。</p>
<div class="hlcode"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span><span class="p">({</span>
    <span class="nx">cssmin</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">minify</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">expand</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">cwd</span><span class="o">:</span> <span class="s1">&#39;css/&#39;</span><span class="p">,</span>
        <span class="nx">src</span><span class="o">:</span> <span class="cp">[</span><span class="s1">&#39;*.css&#39;</span><span class="p">,</span> <span class="s1">&#39;!*.min.css&#39;</span><span class="cp">]</span><span class="p">,</span>
        <span class="nx">dest</span><span class="o">:</span> <span class="s1">&#39;css/&#39;</span><span class="p">,</span>
        <span class="nx">ext</span><span class="o">:</span> <span class="s1">&#39;.min.css&#39;</span>
      <span class="p">},</span>
      <span class="nx">combine</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">files</span><span class="o">:</span> <span class="p">{</span>
          <span class="s1">&#39;css/out.min.css&#39;</span><span class="o">:</span> <span class="cp">[</span><span class="s1">&#39;css/part1.min.css&#39;</span><span class="p">,</span> <span class="s1">&#39;css/part2.min.css&#39;</span><span class="cp">]</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">(</span><span class="s1">&#39;grunt-contrib-cssmin&#39;</span><span class="p">);</span>

  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="cp">[</span><span class="s1">&#39;cssmin:minify&#39;</span><span class="p">,</span><span class="s1">&#39;cssmin:combine&#39;</span><span class="cp">]</span><span class="p">);</span>

<span class="p">};</span>
</pre></div>


<p>下面详细解释上面代码中的三个方法，下面一个个来看。</p>
<p><strong>（1）grunt.loadNpmTasks</strong></p>
<p>grunt.loadNpmTasks方法载入模块文件。</p>
<div class="hlcode"><pre><span class="n">grunt</span><span class="p">.</span><span class="n">loadNpmTasks</span><span class="p">(</span><span class="err">&#39;</span><span class="n">grunt</span><span class="o">-</span><span class="n">contrib</span><span class="o">-</span><span class="n">cssmin</span><span class="err">&#39;</span><span class="p">);</span>
</pre></div>


<p>你需要使用几个模块，这里就要写几条grunt.loadNpmTasks语句，将各个模块一一加载。</p>
<p>如果加载模块很多，这部分会非常冗长。而且，还存在一个问题，就是凡是在这里加载的模块，也同时出现在package.json文件中。如果使用npm命令卸载模块以后，模块会自动从package.json文件中消失，但是必须手动从Gruntfile.js文件中清除，这样很不方便，一旦忘记，还会出现运行错误。这里有一个解决办法，就是安装load-grunt-tasks模块，然后在Gruntfile.js文件中，用下面的语句替代所有的grunt.loadNpmTasks语句。</p>
<div class="hlcode"><pre><span class="n">require</span><span class="p">(</span><span class="err">&#39;</span><span class="n">load</span><span class="o">-</span><span class="n">grunt</span><span class="o">-</span><span class="n">tasks</span><span class="err">&#39;</span><span class="p">)(</span><span class="n">grunt</span><span class="p">);</span>
</pre></div>


<p>这条语句的作用是自动分析package.json文件，自动加载所找到的grunt模块。</p>
<p><strong>（2）grunt.initConfig</strong></p>
<p>grunt.initConfig方法用于模块配置，它接受一个对象作为参数。该对象的成员与使用的同名模块一一对应。由于我们要配置的是cssmin模块，所以里面有一个cssmin成员（属性）。</p>
<p>cssmin（属性）指向一个对象，该对象又包含多个成员。除了一些系统设定的成员（比如options），其他自定义的成员称为目标（target）。一个模块可以有多个目标（target），上面代码里面，cssmin模块共有两个目标，一个是“minify”，用于压缩css文件；另一个是“combine”，用于将多个css文件合并一个文件。</p>
<p>每个目标的具体设置，需要参考该模板的文档。就cssmin来讲，minify目标的参数具体含义如下：</p>
<ul>
<li>
<p><strong>expand</strong>：如果设为true，就表示下面文件名的占位符（即*号）都要扩展成具体的文件名。</p>
</li>
<li>
<p><strong>cwd</strong>：需要处理的文件（input）所在的目录。</p>
</li>
<li>
<p><strong>src</strong>：表示需要处理的文件。如果采用数组形式，数组的每一项就是一个文件名，可以使用通配符。</p>
</li>
<li>
<p><strong>dest</strong>：表示处理后的文件名或所在目录。</p>
</li>
<li>
<p><strong>ext</strong>：表示处理后的文件后缀名。</p>
</li>
</ul>
<p>除了上面这些参数，还有一些参数也是grunt所有模块通用的。</p>
<ul>
<li>
<p><strong>filter</strong>：一个返回布尔值的函数，用于过滤文件名。只有返回值为true的文件，才会被grunt处理。</p>
</li>
<li>
<p><strong>dot</strong>：是否匹配以点号（.）开头的系统文件。</p>
</li>
<li>
<p><strong>makeBase</strong>：如果设置为true，就只匹配文件路径的最后一部分。比如，a?b可以匹配/xyz/123/acb，而不匹配/xyz/acb/123。</p>
</li>
</ul>
<p>关于通配符，含义如下：</p>
<ul>
<li>*：匹配任意数量的字符，不包括/。</li>
<li>?：匹配单个字符，不包括/。</li>
<li>**：匹配任意数量的字符，包括/。</li>
<li>{}：允许使用逗号分隔的列表，表示“or”（或）关系。</li>
<li>!：用于模式的开头，表示只返回不匹配的情况。</li>
</ul>
<p>比如，foo/<em>.js匹配foo目录下面的文件名以.js结尾的文件，foo/</em><em>/</em>.js匹配foo目录和它的所有子目录下面的文件名以.js结尾的文件，!*.css表示匹配所有后缀名不为“.css”的文件。</p>
<p>使用通配符设置src属性的更多例子：</p>
<div class="hlcode"><pre><span class="p">{</span><span class="n">src</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">foo</span><span class="o">/</span><span class="n">th</span><span class="o">*</span><span class="p">.</span><span class="n">js</span><span class="err">&#39;</span><span class="p">}</span><span class="n">grunt</span><span class="o">-</span><span class="n">contrib</span><span class="o">-</span><span class="n">uglify</span>

<span class="p">{</span><span class="n">src</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">foo</span><span class="o">/</span><span class="p">{</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">}</span><span class="o">*</span><span class="p">.</span><span class="n">js</span><span class="err">&#39;</span><span class="p">}</span>

<span class="p">{</span><span class="n">src</span><span class="o">:</span> <span class="p">[</span><span class="err">&#39;</span><span class="n">foo</span><span class="o">/</span><span class="n">a</span><span class="o">*</span><span class="p">.</span><span class="n">js</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">foo</span><span class="o">/</span><span class="n">b</span><span class="o">*</span><span class="p">.</span><span class="n">js</span><span class="err">&#39;</span><span class="p">]}</span>
</pre></div>


<p>至于combine目标，就只有一个files参数，表示输出文件是css子目录下的out.min.css，输入文件则是css子目录下的part1.min.css和part2.min.css。</p>
<p>files参数的格式可以是一个对象，也可以是一个数组。</p>
<div class="hlcode"><pre><span class="nt">files</span><span class="o">:</span> <span class="p">{</span>
        <span class="s1">&#39;dest/b.js&#39;</span><span class="o">:</span> <span class="cp">[</span><span class="s1">&#39;src/bb.js&#39;</span><span class="p">,</span> <span class="s1">&#39;src/bbb.js&#39;</span><span class="cp">]</span><span class="o">,</span>
        <span class="s1">&#39;dest/b1.js&#39;</span><span class="o">:</span> <span class="cp">[</span><span class="s1">&#39;src/bb1.js&#39;</span><span class="p">,</span> <span class="s1">&#39;src/bbb1.js&#39;</span><span class="cp">]</span><span class="o">,</span>
<span class="p">}</span><span class="o">,</span>

<span class="o">//</span> <span class="nt">or</span>

<span class="nt">files</span><span class="o">:</span> <span class="cp">[</span>
        <span class="p">{</span><span class="nb">src</span><span class="p">:</span> <span class="err">[</span><span class="s1">&#39;src/aa.js&#39;</span><span class="p">,</span> <span class="s1">&#39;src/aaa.js&#39;</span><span class="cp">]</span><span class="o">,</span> <span class="nt">dest</span><span class="o">:</span> <span class="s1">&#39;dest/a.js&#39;</span><span class="err">}</span><span class="o">,</span>
        <span class="p">{</span><span class="n">src</span><span class="o">:</span> <span class="cp">[</span><span class="s1">&#39;src/aa1.js&#39;</span><span class="p">,</span> <span class="s1">&#39;src/aaa1.js&#39;</span><span class="cp">]</span><span class="o">,</span> <span class="n">dest</span><span class="o">:</span> <span class="s1">&#39;dest/a1.js&#39;</span><span class="p">}</span><span class="o">,</span>
<span class="o">],</span>
</pre></div>


<p>如果minify目标和combine目标的属性设置有重合的部分，可以另行定义一个与minify和combine平行的options属性。</p>
<div class="hlcode"><pre><span class="n">grunt</span><span class="p">.</span><span class="n">initConfig</span><span class="p">({</span>
    <span class="nl">cssmin:</span> <span class="p">{</span>
      <span class="nl">options:</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">},</span>
      <span class="nl">minify:</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">},</span>
      <span class="nl">combine:</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
</pre></div>


<p><strong>（3）grunt.registerTask</strong></p>
<p>grunt.registerTask方法定义如何调用具体的任务。“default”任务表示如果不提供参数，直接输入grunt命令，则先运行“cssmin:minify”，后运行“cssmin:combine”，即先压缩再合并。如果只执行压缩，或者只执行合并，则需要在grunt命令后面指明“模块名:目标名”。</p>
<div class="hlcode"><pre><span class="n">grunt</span> <span class="err">#</span> <span class="err">默认情况下，先压缩后合并</span>

<span class="n">grunt</span> <span class="n">cssmin</span><span class="o">:</span><span class="n">minify</span> <span class="err">#</span> <span class="err">只压缩不合并</span>

<span class="n">grunt</span> <span class="n">css</span><span class="o">:</span><span class="n">combine</span> <span class="err">#</span> <span class="err">只合并不压缩</span>
</pre></div>


<p>如果不指明目标，只是指明模块，就表示将所有目标依次运行一遍。</p>
<div class="hlcode"><pre><span class="n">grunt</span> <span class="n">cssmin</span>
</pre></div>


<h2 id="_2">常用模块设置</h2>
<p>grunt的<a href="http://gruntjs.com/plugins">模块</a>已经超过了2000个，且还在快速增加。下面是一些常用的模块（按字母排序）。</p>
<ul>
<li><strong>grunt-contrib-clean</strong>：删除文件。</li>
<li><strong>grunt-contrib-compass</strong>：使用compass编译sass文件。</li>
<li><strong>grunt-contrib-concat</strong>：合并文件。</li>
<li><strong>grunt-contrib-copy</strong>：复制文件。</li>
<li><strong>grunt-contrib-cssmin</strong>：压缩以及合并CSS文件。</li>
<li><strong>grunt-contrib-imagemin</strong>：图像压缩模块。</li>
<li><strong>grunt-contrib-jshint</strong>：检查JavaScript语法。</li>
<li><strong>grunt-contrib-uglify</strong>：压缩以及合并JavaScript文件。</li>
<li><strong>grunt-contrib-watch</strong>：监视文件变动，做出相应动作。</li>
</ul>
<p>模块的前缀如果是grunt-contrib，就表示该模块由grunt开发团队维护；如果前缀是grunt（比如grunt-pakmanager），就表示由第三方开发者维护。</p>
<p>以下选几个模块，看看它们配置参数的写法，也就是说如何在grunt.initConfig方法中配置各个模块。</p>
<h3 id="grunt-contrib-jshint">grunt-contrib-jshint</h3>
<p>jshint用来检查语法错误，比如分号的使用是否正确、有没有忘记写括号等等。它在grunt.initConfig方法里面的配置代码如下。</p>
<div class="hlcode"><pre><span class="nl">jshint:</span> <span class="p">{</span>
    <span class="nl">options:</span> <span class="p">{</span>
        <span class="nl">eqeqeq:</span> <span class="nb">true</span><span class="p">,</span>
        <span class="nl">trailing:</span> <span class="nb">true</span>
    <span class="p">},</span>
    <span class="nl">files:</span> <span class="p">[</span><span class="err">&#39;</span><span class="n">Gruntfile</span><span class="p">.</span><span class="n">js</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">lib</span><span class="cm">/**/</span><span class="o">*</span><span class="p">.</span><span class="n">js</span><span class="err">&#39;</span><span class="p">]</span>
<span class="p">},</span>
</pre></div>


<p>上面代码先指定jshint的<a href="http://www.jshint.com/docs/options/">检查项目</a>，eqeqeq表示要用严格相等运算符取代相等运算符，trailing表示行尾不得有多余的空格。然后，指定files属性，表示检查目标是Gruntfile.js文件，以及lib目录的所有子目录下面的JavaScript文件。</p>
<h3 id="grunt-contrib-concat">grunt-contrib-concat</h3>
<p>concat用来合并同类文件，它不仅可以合并JavaScript文件，还可以合并CSS文件。</p>
<div class="hlcode"><pre><span class="nl">concat:</span> <span class="p">{</span>
  <span class="nl">js:</span> <span class="p">{</span>
    <span class="nl">src:</span> <span class="p">[</span><span class="err">&#39;</span><span class="n">lib</span><span class="o">/</span><span class="n">module1</span><span class="p">.</span><span class="n">js</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">lib</span><span class="o">/</span><span class="n">module2</span><span class="p">.</span><span class="n">js</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">lib</span><span class="o">/</span><span class="n">plugin</span><span class="p">.</span><span class="n">js</span><span class="err">&#39;</span><span class="p">],</span>
    <span class="nl">dest:</span> <span class="err">&#39;</span><span class="n">dist</span><span class="o">/</span><span class="n">script</span><span class="p">.</span><span class="n">js</span><span class="err">&#39;</span>
  <span class="p">}</span>
  <span class="nl">css:</span> <span class="p">{</span>
    <span class="nl">src:</span> <span class="p">[</span><span class="err">&#39;</span><span class="n">style</span><span class="o">/</span><span class="n">normalize</span><span class="p">.</span><span class="n">css</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">style</span><span class="o">/</span><span class="n">base</span><span class="p">.</span><span class="n">css</span><span class="err">&#39;</span><span class="p">,</span> <span class="err">&#39;</span><span class="n">style</span><span class="o">/</span><span class="n">theme</span><span class="p">.</span><span class="n">css</span><span class="err">&#39;</span><span class="p">],</span>
    <span class="nl">dest:</span> <span class="err">&#39;</span><span class="n">dist</span><span class="o">/</span><span class="n">screen</span><span class="p">.</span><span class="n">css</span><span class="err">&#39;</span>
  <span class="p">}</span>
<span class="p">},</span>
</pre></div>


<p>js目标用于合并JavaScript文件，css目标用语合并CSS文件。两者的src属性指定需要合并的文件（input），dest属性指定输出的目标文件（output）。</p>
<h3 id="grunt-contrib-uglify">grunt-contrib-uglify</h3>
<p>uglify模块用来压缩代码，减小文件体积。</p>
<div class="hlcode"><pre><span class="nl">uglify:</span> <span class="p">{</span>
  <span class="nl">options:</span> <span class="p">{</span>
    <span class="nl">banner:</span> <span class="n">bannerContent</span><span class="p">,</span>
    <span class="nl">sourceMapRoot:</span> <span class="err">&#39;</span><span class="p">..</span><span class="o">/</span><span class="err">&#39;</span><span class="p">,</span>
    <span class="nl">sourceMap:</span> <span class="err">&#39;</span><span class="n">distrib</span><span class="o">/</span><span class="err">&#39;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="err">&#39;</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">js</span><span class="p">.</span><span class="n">map</span><span class="err">&#39;</span><span class="p">,</span>
    <span class="nl">sourceMapUrl:</span> <span class="n">name</span><span class="o">+</span><span class="err">&#39;</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">js</span><span class="p">.</span><span class="n">map</span><span class="err">&#39;</span>
  <span class="p">},</span>
  <span class="n">target</span> <span class="o">:</span> <span class="p">{</span>
    <span class="nl">expand:</span> <span class="nb">true</span><span class="p">,</span>
    <span class="nl">cwd:</span> <span class="err">&#39;</span><span class="n">js</span><span class="o">/</span><span class="n">origin</span><span class="err">&#39;</span><span class="p">,</span>
    <span class="n">src</span> <span class="o">:</span> <span class="err">&#39;</span><span class="o">*</span><span class="p">.</span><span class="n">js</span><span class="err">&#39;</span><span class="p">,</span>
    <span class="n">dest</span> <span class="o">:</span> <span class="err">&#39;</span><span class="n">js</span><span class="o">/</span><span class="err">&#39;</span>
  <span class="p">}</span>
<span class="p">},</span>
</pre></div>


<p>上面代码中的options属性指定压缩后文件的文件头，以及sourceMap设置；target目标指定输入和输出文件。</p>
<h3 id="grunt-contrib-copy">grunt-contrib-copy</h3>
<p><a href="https://github.com/gruntjs/grunt-contrib-copy">copy模块</a>用于复制文件与目录。</p>
<div class="hlcode"><pre><span class="nl">copy:</span> <span class="p">{</span>
  <span class="nl">main:</span> <span class="p">{</span>
    <span class="nl">src:</span> <span class="err">&#39;</span><span class="n">src</span><span class="o">/*</span><span class="err">&#39;</span><span class="p">,</span>
    <span class="nl">dest:</span> <span class="err">&#39;</span><span class="n">dest</span><span class="o">/</span><span class="err">&#39;</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">},</span>
</pre></div>


<p>上面代码将src子目录（只包含它下面的第一层文件和子目录），拷贝到dest子目录下面（即dest/src目录）。如果要更准确控制拷贝行为，比如只拷贝文件、不拷贝目录、不保持目录结构，可以写成下面这样：</p>
<div class="hlcode"><pre><span class="nl">copy:</span> <span class="p">{</span>
  <span class="nl">main:</span> <span class="p">{</span>
    <span class="nl">expand:</span> <span class="nb">true</span><span class="p">,</span>
    <span class="nl">cwd:</span> <span class="err">&#39;</span><span class="n">src</span><span class="o">/</span><span class="err">&#39;</span><span class="p">,</span>
    <span class="nl">src:</span> <span class="err">&#39;</span><span class="o">**</span><span class="err">&#39;</span><span class="p">,</span>
    <span class="nl">dest:</span> <span class="err">&#39;</span><span class="n">dest</span><span class="o">/</span><span class="err">&#39;</span><span class="p">,</span>
    <span class="nl">flatten:</span> <span class="nb">true</span><span class="p">,</span>
    <span class="nl">filter:</span> <span class="err">&#39;</span><span class="n">isFile</span><span class="err">&#39;</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">},</span>
</pre></div>


<h3 id="grunt-contrib-watch">grunt-contrib-watch</h3>
<p><a href="https://github.com/gruntjs/grunt-contrib-watch">watch模块</a>用来在后台运行，监听指定事件，然后自动运行指定的任务。</p>
<div class="hlcode"><pre><span class="nl">watch:</span> <span class="p">{</span>
   <span class="nl">scripts:</span> <span class="p">{</span>
    <span class="nl">files:</span> <span class="err">&#39;</span><span class="o">*</span><span class="err">*/</span><span class="o">*</span><span class="p">.</span><span class="n">js</span><span class="err">&#39;</span><span class="p">,</span>
    <span class="nl">tasks:</span> <span class="err">&#39;</span><span class="n">jshint</span><span class="err">&#39;</span><span class="p">,</span>
    <span class="nl">options:</span> <span class="p">{</span>
      <span class="nl">livereload:</span> <span class="nb">true</span><span class="p">,</span>
    <span class="p">},</span>
   <span class="p">},</span>
   <span class="nl">css:</span> <span class="p">{</span>
    <span class="nl">files:</span> <span class="err">&#39;</span><span class="o">*</span><span class="err">*/</span><span class="o">*</span><span class="p">.</span><span class="n">sass</span><span class="err">&#39;</span><span class="p">,</span>
    <span class="nl">tasks:</span> <span class="p">[</span><span class="err">&#39;</span><span class="n">sass</span><span class="err">&#39;</span><span class="p">],</span>
    <span class="nl">options:</span> <span class="p">{</span>
      <span class="nl">livereload:</span> <span class="nb">true</span><span class="p">,</span>
    <span class="p">},</span>
   <span class="p">},</span>
<span class="p">},</span>
</pre></div>


<p>设置好上面的代码，打开另一个进程，运行grunt watch。此后，任何的js代码变动，文件保存后就会自动运行jshint任务；任何sass文件变动，文件保存后就会自动运行sass任务。</p>
<p>需要注意的是，这两个任务的options参数之中，都设置了livereload，表示任务运行结束后，自动在浏览器中重载（reload）。这需要在浏览器中安装<a href="http://livereload.com/">livereload插件</a>。安装后，livereload的默认端口为localhost:35729，但是也可以用livereload: 1337的形式重设端口（localhost:1337）。</p>
<h3 id="_3">其他模块</h3>
<p>下面是另外一些有用的模块。</p>
<p><strong>（1）grunt-contrib-clean</strong></p>
<p>该模块用于删除文件或目录。</p>
<div class="hlcode"><pre><span class="nl">clean:</span> <span class="p">{</span>
  <span class="nl">build:</span> <span class="p">{</span>
    <span class="nl">src:</span> <span class="p">[</span><span class="s">&quot;path/to/dir/one&quot;</span><span class="p">,</span> <span class="s">&quot;path/to/dir/two&quot;</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p><strong>（2）grunt-autoprefixer</strong></p>
<p>该模块用于为CSS语句加上浏览器前缀。</p>
<div class="hlcode"><pre><span class="nl">autoprefixer:</span> <span class="p">{</span>
  <span class="nl">build:</span> <span class="p">{</span>
    <span class="nl">expand:</span> <span class="nb">true</span><span class="p">,</span>
    <span class="nl">cwd:</span> <span class="err">&#39;</span><span class="n">build</span><span class="err">&#39;</span><span class="p">,</span>
    <span class="nl">src:</span> <span class="p">[</span> <span class="err">&#39;</span><span class="o">*</span><span class="err">*/</span><span class="o">*</span><span class="p">.</span><span class="n">css</span><span class="err">&#39;</span> <span class="p">],</span>
    <span class="nl">dest:</span> <span class="err">&#39;</span><span class="n">build</span><span class="err">&#39;</span>
  <span class="p">}</span>
<span class="p">},</span>
</pre></div>


<p><strong>（3）grunt-contrib-connect</strong></p>
<p>该模块用于在本机运行一个Web Server。</p>
<div class="hlcode"><pre><span class="nl">connect:</span> <span class="p">{</span>
  <span class="nl">server:</span> <span class="p">{</span>
    <span class="nl">options:</span> <span class="p">{</span>
      <span class="nl">port:</span> <span class="mi">4000</span><span class="p">,</span>
      <span class="nl">base:</span> <span class="err">&#39;</span><span class="n">build</span><span class="err">&#39;</span><span class="p">,</span>
      <span class="nl">hostname:</span> <span class="sc">&#39;*&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>connect模块会随着grunt运行结束而结束，为了使它一直处于运行状态，可以把它放在watch模块之前运行。因为watch模块需要手动中止，所以connect模块也就会一直运行。</p>
<p><strong>（4）grunt-htmlhint</strong></p>
<p>该模块用于检查HTML语法。</p>
<div class="hlcode"><pre><span class="nl">htmlhint:</span> <span class="p">{</span>
    <span class="nl">build:</span> <span class="p">{</span>
        <span class="nl">options:</span> <span class="p">{</span>
            <span class="err">&#39;</span><span class="n">tag</span><span class="o">-</span><span class="n">pair</span><span class="err">&#39;</span><span class="o">:</span> <span class="nb">true</span><span class="p">,</span>
            <span class="err">&#39;</span><span class="n">tagname</span><span class="o">-</span><span class="n">lowercase</span><span class="err">&#39;</span><span class="o">:</span> <span class="nb">true</span><span class="p">,</span>
            <span class="err">&#39;</span><span class="n">attr</span><span class="o">-</span><span class="n">lowercase</span><span class="err">&#39;</span><span class="o">:</span> <span class="nb">true</span><span class="p">,</span>
            <span class="err">&#39;</span><span class="n">attr</span><span class="o">-</span><span class="n">value</span><span class="o">-</span><span class="kt">double</span><span class="o">-</span><span class="n">quotes</span><span class="err">&#39;</span><span class="o">:</span> <span class="nb">true</span><span class="p">,</span>
            <span class="err">&#39;</span><span class="n">spec</span><span class="o">-</span><span class="kt">char</span><span class="o">-</span><span class="n">escape</span><span class="err">&#39;</span><span class="o">:</span> <span class="nb">true</span><span class="p">,</span>
            <span class="err">&#39;</span><span class="n">id</span><span class="o">-</span><span class="n">unique</span><span class="err">&#39;</span><span class="o">:</span> <span class="nb">true</span><span class="p">,</span>
            <span class="err">&#39;</span><span class="n">head</span><span class="o">-</span><span class="n">script</span><span class="o">-</span><span class="n">disabled</span><span class="err">&#39;</span><span class="o">:</span> <span class="nb">true</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="nl">src:</span> <span class="p">[</span><span class="err">&#39;</span><span class="n">index</span><span class="p">.</span><span class="n">html</span><span class="err">&#39;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>上面代码用于检查index.html文件：HTML标记是否配对、标记名和属性名是否小写、属性值是否包括在双引号之中、特殊字符是否转义、HTML元素的id属性是否为唯一值、head部分是否没有script标记。</p>
<p><strong>（5）grunt-contrib-sass模块</strong></p>
<p>该模块用于将SASS文件转为CSS文件。</p>
<div class="hlcode"><pre><span class="nl">sass:</span> <span class="p">{</span>
    <span class="nl">build:</span> <span class="p">{</span>
        <span class="nl">options:</span> <span class="p">{</span>
            <span class="nl">style:</span> <span class="err">&#39;</span><span class="n">compressed</span><span class="err">&#39;</span>
        <span class="p">},</span>
        <span class="nl">files:</span> <span class="p">{</span>
            <span class="err">&#39;</span><span class="n">build</span><span class="o">/</span><span class="n">css</span><span class="o">/</span><span class="n">master</span><span class="p">.</span><span class="n">css</span><span class="err">&#39;</span><span class="o">:</span> <span class="err">&#39;</span><span class="n">assets</span><span class="o">/</span><span class="n">sass</span><span class="o">/</span><span class="n">master</span><span class="p">.</span><span class="n">scss</span><span class="err">&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>上面代码指定输出文件为build/css/master.css，输入文件为assets/sass/master.scss。</p>
<p><strong>（6）grunt-markdown</strong></p>
<p>该模块用于将markdown文档转为HTML文档。</p>
<div class="hlcode"><pre><span class="nt">markdown</span><span class="o">:</span> <span class="p">{</span>
    <span class="n">all</span><span class="o">:</span> <span class="err">{</span>
      <span class="n">files</span><span class="o">:</span> <span class="cp">[</span>
        <span class="p">{</span>
          <span class="nx">expand</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
          <span class="nb">src</span><span class="p">:</span> <span class="s1">&#39;*.md&#39;</span><span class="p">,</span>
          <span class="nx">dest</span><span class="p">:</span> <span class="s1">&#39;docs/html/&#39;</span><span class="p">,</span>
          <span class="nx">ext</span><span class="p">:</span> <span class="s1">&#39;.html&#39;</span>
        <span class="p">}</span>
      <span class="cp">]</span><span class="o">,</span>
      <span class="n">options</span><span class="o">:</span> <span class="err">{</span>
        <span class="n">template</span><span class="o">:</span> <span class="s1">&#39;templates/index.html&#39;</span><span class="o">,</span>
      <span class="p">}</span>
    <span class="err">}</span>
<span class="err">}</span><span class="o">,</span>
</pre></div>


<p>上面代码指定将md后缀名的文件，转为docs/html/目录下的html文件。template属性指定转换时采用的模板，模板样式如下。</p>
<div class="hlcode"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Document<span class="nt">&lt;/title&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;main&quot;</span> <span class="na">class=</span><span class="s">&quot;container&quot;</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span><span class="n">content</span><span class="cp">%&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>


<h2 id="_4">参考链接</h2>
<ul>
<li>Frederic Hemberger, <a href="http://frederic-hemberger.de/artikel/grunt-buildtool-for-frontend-projects/">A build tool for front-end projects</a></li>
<li>Mária Jurčovičová, <a href="http://flippinawesome.org/2013/07/01/building-a-javascript-library-with-grunt-js/">Building a JavaScript Library with Grunt.js</a></li>
<li>Ben Briggs，<a href="http://sixrevisions.com/javascript/grunt-tutorial-01/">Speed Up Your Web Development Workflow with Grunt</a></li>
<li><a href="http://blog.grayghostvisuals.com/grunt/image-optimization/">Optimizing Images With Grunt</a></li>
<li>Swapnil Mishra, <a href="http://howtonode.org/c4e0f8565942d5e6df45fb78b12d19435543c236/simplifying-chores-with-grunt">Simplifying Chores with Grunt</a></li>
<li>AJ ONeal, <a href="http://blog.coolaj86.com/articles/moving-to-grunt.html">Moving to GruntJS</a></li>
<li>Grunt Documentation, <a href="http://gruntjs.com/configuring-tasks">Configuring tasks</a></li>
<li>Landon Schropp, <a href="http://www.sitepoint.com/writing-awesome-build-script-grunt/">Writing an Awesome Build Script with Grunt</a></li>
<li>Mike Cunsolo, <a href="http://coding.smashingmagazine.com/2013/10/29/get-up-running-grunt/">Get Up And Running With Grunt</a></li>
<li>Matt Bailey, <a href="http://www.gpmd.co.uk/blog/a-beginners-guide-to-using-grunt-with-magento/">A Beginner’s Guide to Using Grunt With Magento</a></li>
<li>Paul Bakaus, <a href="http://www.html5rocks.com/en/tutorials/tooling/supercharging-your-gruntfile/">Supercharging your Gruntfile</a></li>
</ul>
<h2 id="_5">功能链接</h2>
<ul>
<li><a href="https://github.com/ruanyf/jstutorial/issues">论坛</a></li>
<li><a href="https://raw.github.com/ruanyf/jstutorial/gh-pages/tool/grunt.md">Markdown源码</a></li>
<li><a href="https://github.com/ruanyf/jstutorial/commits/gh-pages/tool/grunt.md">修订历史</a></li>
</ul>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2020 Tsong khapa.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2020-10-02 22:54:23</p>
      </span>
    </div>

    
    
  </body>
</html>