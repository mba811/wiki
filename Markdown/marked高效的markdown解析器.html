<!DOCTYPE HTML>
<html>
  <head>
    <link rel="Stylesheet" type="text/css" href="/static/css/style.css">
    <link rel="Stylesheet" type="text/css" href="/static/css/tango.css">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
    <title>Marked高效的Markdown解析器 - Wiki · Tsong khapa</title>
    <meta name="keywords" content="simiki, wiki, python, simple"/>
    <meta name="description" content="Tanky Woo's personal wiki, powered by vim and markdown. Focus on Python, C/C++, Linux, Ops-Dev, Gentoo, and so on."/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  </head>

  <body>
    <div id="container">
      
<div id="header">
  <div class="post-nav"><a href="/">Home</a>&nbsp;&#187;&nbsp;<a href="/#Markdown">Markdown</a>&nbsp;&#187;&nbsp;Marked高效的Markdown解析器
    <span class="updated">Page Updated&nbsp;
      2015-05-25 10:09
    </span></div>
</div>
<div class="clearfix"></div>

<div class="page_title">Marked高效的Markdown解析器</div>

  <p><strong>前言</strong></p>
<p>Markdown以一种轻巧简明的设计理念，赋予了Web文档新的活力，从而代替传统以Word为主导的电子文档。Markdown大量简化了HTML标签，被广大的互联网应用所使用。程序员所熟知的Github就完全基于Markdown语法，真的可以不再需要Word了。</p>
<p>Markdown不是HTML，目前还不能被浏览器解析，所以我们需要Markdown的解析器，把Markdown翻译成浏览器认识的HTML文档展示出来。Marked就是一个基于Nodejs的Markdown解析引擎！</p>
<p><strong>目录</strong></p>
<ol>
<li>markdown介绍</li>
<li>marked安装</li>
<li>marked命令行使用</li>
<li>marked的API使用</li>
<li>marked的个性化渲染</li>
</ol>
<h2 id="1-markdown">1. markdown介绍</h2>
<p>Markdown 是一种轻量级标记语言，创始人为约翰·格鲁伯（John Gruber）。它允许人们“使用易读易写的纯文本格式编写文档，然后转换成有效的XHTML(或者HTML)文档”。这种语言吸收了很多在电子邮件中已有的纯文本标记的特性。</p>
<p>Markdown 的目标是实现「易读易写」。</p>
<p>可读性，无论如何，都是最重要的。一份使用 Markdown 格式撰写的文件应该可以直接以纯文本发布，并且看起来不会像是由许多标签或是格式指令所构成。Markdown 语法受到一些既有 text-to-HTML 格式的影响，包括 Setext、atx、Textile、reStructuredText、Grutatext 和 EtText，而最大灵感来源其实是纯文本电子邮件的格式。</p>
<p>Markdown的语法简洁明了、学习容易，而且功能比纯文本更强，因此有很多人用它写博客。世界上最流行的博客平台WordPress和大型CMS如joomla、drupal都能很好的支持Markdown，Github也是支持markdown的，在个性化语法上也做了不少的改进。Markdown的中文语法介绍：<a href="http://wowubuntu.com/markdown/">http://wowubuntu.com/markdown/</a></p>
<p>2款不错的markdown的在线编辑器：</p>
<ul>
<li><a href="https://www.zybuluo.com/mdeditor">https://www.zybuluo.com/mdeditor</a></li>
<li><a href="http://maxiang.info/">http://maxiang.info/</a></li>
</ul>
<p>如果你还没有开始用Markdown来写文档，那你一定OUT了。</p>
<h2 id="2-marked">2. marked安装</h2>
<p>系统环境</p>
<ul>
<li>Win7 64bit</li>
<li>Nodejs:v0.10.31</li>
<li>Npm:1.4.23</li>
</ul>
<p>创建项目</p>
<div class="hlcode"><pre><span class="o">~</span> <span class="n">cd</span> <span class="n">D</span><span class="o">:</span><span class="err">\</span><span class="n">workspace</span><span class="err">\</span><span class="n">javascript</span><span class="o">&gt;</span>
<span class="o">~</span> <span class="n">D</span><span class="o">:</span><span class="err">\</span><span class="n">workspace</span><span class="err">\</span><span class="n">javascript</span><span class="o">&gt;</span><span class="n">mkdir</span> <span class="n">nodejs</span><span class="o">-</span><span class="n">marked</span> <span class="o">&amp;&amp;</span> <span class="n">cd</span> <span class="n">nodejs</span><span class="o">-</span><span class="n">marked</span>
</pre></div>


<p>新建项目文件package.json</p>
<div class="hlcode"><pre><span class="o">~</span> <span class="n">D</span><span class="o">:</span><span class="err">\</span><span class="n">workspace</span><span class="err">\</span><span class="n">javascript</span><span class="err">\</span><span class="n">nodejs</span><span class="o">-</span><span class="n">marked</span><span class="o">&gt;</span><span class="n">notepad</span> <span class="n">package</span><span class="p">.</span><span class="n">json</span>
<span class="p">{</span>
  <span class="s">&quot;name&quot;</span><span class="o">:</span> <span class="s">&quot;marked-demo&quot;</span><span class="p">,</span>
  <span class="s">&quot;version&quot;</span><span class="o">:</span> <span class="s">&quot;0.0.1&quot;</span><span class="p">,</span>
  <span class="s">&quot;private&quot;</span><span class="o">:</span> <span class="nb">true</span><span class="p">,</span>
  <span class="s">&quot;dependencies&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>安装marked库，全局安装，同时在本地项目安装。</p>
<div class="hlcode"><pre><span class="o">~</span> <span class="n">D</span><span class="o">:</span><span class="err">\</span><span class="n">workspace</span><span class="err">\</span><span class="n">javascript</span><span class="err">\</span><span class="n">nodejs</span><span class="o">-</span><span class="n">marked</span><span class="o">&gt;</span><span class="n">npm</span> <span class="n">install</span> <span class="n">marked</span> <span class="o">--</span><span class="n">save</span> <span class="o">-</span><span class="n">g</span>
<span class="nl">C:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">Administrator</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="n">Roaming</span><span class="err">\</span><span class="n">npm</span><span class="err">\</span><span class="n">marked</span> <span class="o">-&gt;</span> <span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">Administrator</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="n">Roaming</span><span class="err">\</span><span class="n">npm</span><span class="err">\</span><span class="n">node_modules</span><span class="err">\</span><span class="n">marked</span><span class="err">\</span><span class="n">bin</span>\
<span class="n">marked</span>
<span class="n">marked</span><span class="err">@</span><span class="mf">0.3.3</span> <span class="n">C</span><span class="o">:</span><span class="err">\</span><span class="n">Users</span><span class="err">\</span><span class="n">Administrator</span><span class="err">\</span><span class="n">AppData</span><span class="err">\</span><span class="n">Roaming</span><span class="err">\</span><span class="n">npm</span><span class="err">\</span><span class="n">node_modules</span><span class="err">\</span><span class="n">marked</span>
</pre></div>


<p>通过-save参数，package.json文件中会自动增加marked库的依赖。</p>
<div class="hlcode"><pre><span class="o">~</span> <span class="n">D</span><span class="o">:</span><span class="err">\</span><span class="n">workspace</span><span class="err">\</span><span class="n">javascript</span><span class="err">\</span><span class="n">nodejs</span><span class="o">-</span><span class="n">marked</span><span class="o">&gt;</span><span class="n">cat</span> <span class="n">package</span><span class="p">.</span><span class="n">json</span>
<span class="p">{</span>
  <span class="s">&quot;name&quot;</span><span class="o">:</span> <span class="s">&quot;marked-demo&quot;</span><span class="p">,</span>
  <span class="s">&quot;version&quot;</span><span class="o">:</span> <span class="s">&quot;0.0.1&quot;</span><span class="p">,</span>
  <span class="s">&quot;private&quot;</span><span class="o">:</span> <span class="nb">true</span><span class="p">,</span>
  <span class="s">&quot;dependencies&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s">&quot;marked&quot;</span><span class="o">:</span> <span class="s">&quot;^0.3.3&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>通过-g参数，完成了marked库的全局安装，这时我们就可以直接在命令，使用marked的命令了。</p>
<p>查看命令行帮助，直接就报错误了，真是出师不利啊。</p>
<div class="hlcode"><pre><span class="o">~</span> <span class="n">D</span><span class="o">:</span><span class="err">\</span><span class="n">workspace</span><span class="err">\</span><span class="n">javascript</span><span class="err">\</span><span class="n">nodejs</span><span class="o">-</span><span class="n">marked</span><span class="o">&gt;</span><span class="n">marked</span> <span class="o">-</span><span class="n">h</span>
<span class="nl">child_process:</span> <span class="n">customFds</span> <span class="n">option</span> <span class="n">is</span> <span class="n">deprecated</span><span class="p">,</span> <span class="n">use</span> <span class="n">stdio</span> <span class="n">instead</span><span class="p">.</span>
<span class="n">events</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">85</span>
      <span class="n">throw</span> <span class="n">er</span><span class="p">;</span> <span class="c1">// Unhandled &#39;error&#39; event</span>
            <span class="o">^</span>
<span class="nl">Error:</span> <span class="n">spawn</span> <span class="n">man</span> <span class="n">ENOENT</span>
    <span class="n">at</span> <span class="n">exports</span><span class="p">.</span><span class="n">_errnoException</span> <span class="p">(</span><span class="n">util</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">746</span><span class="o">:</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">at</span> <span class="n">Process</span><span class="p">.</span><span class="n">ChildProcess</span><span class="p">.</span><span class="n">_handle</span><span class="p">.</span><span class="n">onexit</span> <span class="p">(</span><span class="n">child_process</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">1046</span><span class="o">:</span><span class="mi">32</span><span class="p">)</span>
    <span class="n">at</span> <span class="n">child_process</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">1137</span><span class="o">:</span><span class="mi">20</span>
    <span class="n">at</span> <span class="n">process</span><span class="p">.</span><span class="n">_tickCallback</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">355</span><span class="o">:</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">at</span> <span class="n">Function</span><span class="p">.</span><span class="n">Module</span><span class="p">.</span><span class="n">runMain</span> <span class="p">(</span><span class="n">module</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">503</span><span class="o">:</span><span class="mi">11</span><span class="p">)</span>
    <span class="n">at</span> <span class="n">startup</span> <span class="p">(</span><span class="n">node</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">129</span><span class="o">:</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">at</span> <span class="n">node</span><span class="p">.</span><span class="n">js</span><span class="o">:</span><span class="mi">814</span><span class="o">:</span><span class="mi">3</span>
</pre></div>


<p>定位错误，找到./node_modules/marked/bin/marked文件中help()函数，如下代码所示，这种写法不适用于Window系统，所以才出现-h报错的情况。庆幸的是，其他的功能命令参数都是正确的。</p>
<div class="hlcode"><pre><span class="kd">function</span> <span class="nx">help</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">spawn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;child_process&#39;</span><span class="p">).</span><span class="nx">spawn</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">cwd</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span>
    <span class="nx">env</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">,</span>
    <span class="nx">setsid</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">customFds</span><span class="o">:</span> <span class="cp">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="cp">]</span>
  <span class="p">};</span>

  <span class="nx">spawn</span><span class="p">(</span><span class="s1">&#39;man&#39;</span><span class="p">,</span>
    <span class="cp">[</span><span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/../man/marked.1&#39;</span><span class="cp">]</span><span class="p">,</span>
    <span class="nx">options</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>在Linux环境，我们看一下帮助命令。</p>
<div class="hlcode"><pre><span class="err">~</span> <span class="nx">marked</span> <span class="na">-h</span>

<span class="nx">marked</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>                               <span class="nx">marked.js</span>                               <span class="nx">marked</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="nb">NAME</span>
       <span class="nx">marked</span> <span class="o">-</span> <span class="nx">a</span> <span class="nb">javascript</span> <span class="nx">markdown</span> <span class="nx">parser</span>

<span class="nx">SYNOPSIS</span>
       <span class="nx">marked</span>  <span class="err">[</span><span class="na">-o</span>  <span class="cp">]</span>  <span class="cp">[</span><span class="na">-i</span>  <span class="o">&lt;</span><span class="nb">input</span><span class="o">&gt;</span><span class="cp">]</span>  <span class="cp">[</span><span class="o">--</span><span class="nx">help</span><span class="cp">]</span>  <span class="cp">[</span><span class="o">--</span><span class="nx">tokens</span><span class="cp">]</span>  <span class="cp">[</span><span class="o">--</span><span class="nx">pedantic</span><span class="cp">]</span>  <span class="cp">[</span><span class="o">--</span><span class="nx">gfm</span><span class="cp">]</span>
       <span class="cp">[</span><span class="o">--</span><span class="nx">breaks</span><span class="cp">]</span>  <span class="cp">[</span><span class="o">--</span><span class="nb">tables</span><span class="cp">]</span>  <span class="cp">[</span><span class="o">--</span><span class="nx">sanitize</span><span class="cp">]</span>  <span class="cp">[</span><span class="o">--</span><span class="nx">smart</span><span class="na">-lists</span><span class="cp">]</span>   <span class="cp">[</span><span class="o">--</span><span class="nb">lang</span><span class="na">-prefix</span>   <span class="o">&lt;</span><span class="nb">prefix</span><span class="o">&gt;</span><span class="cp">]</span>
       <span class="cp">[</span><span class="o">--</span><span class="nx">no</span><span class="na">-etc...</span><span class="cp">]</span> <span class="cp">[</span><span class="o">--</span><span class="nx">silent</span><span class="cp">]</span> <span class="cp">[</span><span class="nb">filename</span><span class="cp">]</span>

DESCRIPTION
       marked  is  a  full-featured  javascript markdown parser, built for speed. It also
       includes multiple GFM features.

EXAMPLES
       cat in.md | marked &gt; out.html
       echo &quot;hello *world*&quot; | marked
       marked -o out.html in.md --gfm
       marked --output=&quot;hello world.html&quot; -i in.md --no-breaks

OPTIONS
       -o, --output <span class="cp">[</span><span class="nb">output</span><span class="cp">]</span>
              Specify file output. If none is specified, write to stdout.
       -i, --input <span class="cp">[</span><span class="nb">input</span><span class="cp">]</span>
              Specify file input, otherwise use last argument as input file. If no  input
              file is specified, read from stdin.
       -t, --tokens
              Output a token stream instead of html.
       --pedantic
              Conform  to  obscure  parts  of  markdown.pl as much as possible. Don&#39;t fix
              original markdown bugs.
       --gfm  Enable github flavored markdown.
       --breaks
              Enable GFM line breaks. Only works with the gfm option.
       --tables
              Enable GFM tables. Only works with the gfm option.
       --sanitize
              Sanitize output. Ignore any HTML input.
       --smart-lists
              Use smarter list behavior than the original markdown.
       --lang-prefix <span class="cp">[</span><span class="nb">prefix</span><span class="cp">]</span>
              Set the prefix for code block classes.
       --no-sanitize, -no-etc...
              The inverse of any of the marked options above.
       --silent
              Silence error output.
       -h, --help
              Display help information.

CONFIGURATION
       For configuring and running programmatically.
       Example
           require(&#39;marked&#39;)(&#39;*foo*&#39;, { gfm: true });
BUGS
       Please report any bugs to https://github.com/chjj/marked.
LICENSE
       Copyright (c) 2011-2014, Christopher Jeffrey (MIT License).
SEE ALSO
       markdown(1), node.js(1)
</pre></div>


<h2 id="3-marked">3. marked命令行使用</h2>
<p>参数说明：</p>
<ul>
<li>-o, –output [output]: 指定输出文件，默认为当前控制台</li>
<li>-i, –input [input]: 指定输入文件或最后一个参数，默认为当前控制台输入</li>
<li>-t, –tokens: 输出token流代替HTML</li>
<li>–pedantic: 只解析符合markdown.pl定义的，不修正markdown的错误</li>
<li>–gfm: 启动Github样式的Markdown，请参考 <a href="https://help.github.com/articles/github-flavored-markdown/">https://help.github.com/articles/github-flavored-markdown/</a></li>
<li>–breaks: 支持Github换行符，必须打开gfm选项</li>
<li>–tables: 支持Github表格，必须打开gfm选项</li>
<li>–sanitize: 原始输出，忽略HTML标签</li>
<li>–smart-lists: 优化列表输出</li>
<li>–lang-prefix [prefix]: 设置前置样式</li>
<li>–no-etc: 选择的反正标识</li>
<li>–silent: 不输出错误信息</li>
<li>-h, –help: 帮助信息</li>
</ul>
<p>下面我们就直接使用命令行来处理markdown的文件。</p>
<p>新建一个Markdown文件m1.md，其中包括了文字，代码，段落，列表，格式。</p>
<div class="hlcode"><pre><span class="n">Marked</span> <span class="n">Demo</span>
<span class="o">======================</span>

<span class="err">这是一个</span><span class="n">Marked</span><span class="err">库使用的例子。</span> <span class="n">http</span><span class="o">:</span><span class="c1">//blog.fens.me/nodejs-markdown-marked/</span>

<span class="o">&gt;</span> <span class="n">A</span> <span class="n">full</span><span class="o">-</span><span class="n">featured</span> <span class="n">markdown</span> <span class="n">parser</span> <span class="n">and</span> <span class="n">compiler</span><span class="p">,</span> <span class="n">written</span> <span class="k">in</span> <span class="n">JavaScript</span><span class="p">.</span> <span class="n">Built</span>
<span class="o">&gt;</span> <span class="k">for</span> <span class="n">speed</span><span class="p">.</span>

<span class="p">[</span><span class="o">!</span><span class="p">[</span><span class="n">NPM</span> <span class="n">version</span><span class="p">](</span><span class="n">https</span><span class="o">:</span><span class="c1">//badge.fury.io/js/marked.png)][badge]</span>

<span class="cp">## Install</span>

<span class="err">```</span> <span class="n">bash</span>
<span class="n">npm</span> <span class="n">install</span> <span class="n">marked</span> <span class="o">--</span><span class="n">save</span>
<span class="err">```</span>

<span class="cp">## 列表测试</span>

<span class="o">+</span> <span class="err">列表测试，行</span><span class="mi">1</span>
<span class="o">+</span> <span class="err">列表测试，行</span><span class="mi">2</span>
<span class="o">+</span> <span class="err">列表测试，行</span><span class="mi">3</span>
<span class="o">+</span> <span class="err">列表测试，行</span><span class="mi">4</span>

<span class="cp">## 表格测试</span>

<span class="n">A</span> <span class="o">|</span> <span class="n">B</span> <span class="o">|</span> <span class="n">C</span>
<span class="o">--|--|--</span>
<span class="n">A1</span> <span class="o">|</span> <span class="n">B1</span> <span class="o">|</span> <span class="n">C1</span>
<span class="n">A2</span> <span class="o">|</span> <span class="n">B2</span> <span class="o">|</span> <span class="n">C2</span>
<span class="n">A3</span> <span class="o">|</span> <span class="n">B3</span> <span class="o">|</span> <span class="n">C3</span>
</pre></div>


<p>使用命令行生成HTML。</p>
<div class="hlcode"><pre><span class="nb">D</span><span class="p">:</span><span class="o">\</span><span class="nx">workspace</span><span class="o">\</span><span class="nb">javascript</span><span class="o">\</span><span class="nx">nodejs</span><span class="na">-marked</span><span class="o">&gt;</span><span class="nx">marked</span> <span class="na">-i</span> <span class="nx">m1.md</span>
<span class="o">&lt;</span><span class="nx">h1</span> <span class="n">id</span><span class="o">=</span><span class="s2">&quot;marked-demo&quot;</span><span class="o">&gt;</span><span class="nx">Marked</span> <span class="nx">Demo</span><span class="o">&lt;/</span><span class="nx">h1</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">这是一个Marked库使用的例子</span><span class="err">。</span> <span class="o">&lt;</span><span class="nx">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;http://blog.fens.me/nodejs-markdown-marked/&quot;</span><span class="o">&gt;</span><span class="nx">http</span><span class="p">:</span><span class="c1">//blog.fens.me/nodejs-man-marked/&lt;/a&gt;&lt;/p&gt;</span>
<span class="o">&lt;</span><span class="nx">blockquote</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">A</span> <span class="kc">full</span><span class="na">-featured</span> <span class="nx">markdown</span> <span class="nx">parser</span> <span class="ow">and</span> <span class="nx">compiler</span><span class="p">,</span> <span class="n">written</span> <span class="k">in</span> <span class="nx">JavaScript.</span> <span class="nx">Built</span>
<span class="nb">for</span> <span class="nx">speed.</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nx">blockquote</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="err">[</span><span class="o">&lt;</span><span class="nb">img</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;https://badge.fury.io/js/marked.png&quot;</span> <span class="n">alt</span><span class="o">=</span><span class="s2">&quot;NPM version&quot;</span><span class="o">&gt;</span><span class="cp">][</span><span class="nx">badge</span><span class="cp">]</span><span class="err">&lt;</span>/p<span class="err">&lt;</span>
<span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">&quot;install&quot;</span><span class="nt">&gt;</span>Install<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;lang-bash&quot;</span><span class="nt">&gt;</span>npm install marked --save
<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
<span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">&quot;-&quot;</span><span class="nt">&gt;</span>列表测试<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;ul&gt;</span>
<span class="nt">&lt;li&gt;</span>列表测试，行1<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;li&gt;</span>列表测试，行2<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;li&gt;</span>列表测试，行3<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;li&gt;</span>列表测试，行4<span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;h2</span> <span class="na">id=</span><span class="s">&quot;-&quot;</span><span class="nt">&gt;</span>表格测试<span class="nt">&lt;/h2&gt;</span>
<span class="nt">&lt;table&gt;</span>
<span class="nt">&lt;thead&gt;</span>
<span class="nt">&lt;tr&gt;</span>
<span class="nt">&lt;th&gt;</span>A<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;th&gt;</span>B<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;th&gt;</span>C<span class="nt">&lt;/th&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/thead&gt;</span>
<span class="nt">&lt;tbody&gt;</span>
<span class="nt">&lt;tr&gt;</span>
<span class="nt">&lt;td&gt;</span>A1<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;td&gt;</span>B1<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;td&gt;</span>C1<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;tr&gt;</span>
<span class="nt">&lt;td&gt;</span>A2<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;td&gt;</span>B2<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;td&gt;</span>C2<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;tr&gt;</span>
<span class="nt">&lt;td&gt;</span>A3<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;td&gt;</span>B3<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;td&gt;</span>C3<span class="nt">&lt;/td&gt;</span>
<span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</pre></div>


<p>从代码上面看，所有的标签都被正确解析了。再把命令行的各种参数组合一下，看看是不是会有不一样的效果。</p>
<p>增加-o的参数，输出到指定文件中。</p>
<div class="hlcode"><pre><span class="o">~</span> <span class="n">D</span><span class="o">:</span><span class="err">\</span><span class="n">workspace</span><span class="err">\</span><span class="n">javascript</span><span class="err">\</span><span class="n">nodejs</span><span class="o">-</span><span class="n">marked</span><span class="o">&gt;</span><span class="n">marked</span> <span class="o">-</span><span class="n">i</span> <span class="n">m1</span><span class="p">.</span><span class="n">md</span> <span class="o">-</span><span class="n">o</span> <span class="n">m1_out</span><span class="p">.</span><span class="n">html</span>

<span class="o">~</span> <span class="n">D</span><span class="o">:</span><span class="err">\</span><span class="n">workspace</span><span class="err">\</span><span class="n">javascript</span><span class="err">\</span><span class="n">nodejs</span><span class="o">-</span><span class="n">marked</span><span class="o">&gt;</span><span class="n">ls</span> <span class="n">m1</span><span class="o">*</span>
<span class="n">m1</span><span class="p">.</span><span class="n">md</span>  <span class="n">m1_out</span><span class="p">.</span><span class="n">html</span>
</pre></div>


<p>增加-t的参数，以token形式输出。</p>
<div class="hlcode"><pre><span class="o">~</span> <span class="nt">D</span><span class="o">:</span><span class="err">\</span><span class="nt">workspace</span><span class="err">\</span><span class="nt">javascript</span><span class="err">\</span><span class="nt">nodejs-marked</span><span class="o">&gt;</span><span class="nt">marked</span> <span class="nt">-t</span> <span class="nt">-i</span> <span class="nt">m1</span><span class="nc">.md</span>
<span class="cp">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;heading&quot;</span><span class="p">,</span>
    <span class="s2">&quot;depth&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;Marked Demo&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;paragraph&quot;</span><span class="p">,</span>
    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;这是一个Marked库使用的例子。&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;blockquote_start&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;paragraph&quot;</span><span class="p">,</span>
    <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="s2">&quot;A full-featured markdown parser and compiler, written in JavaScript. Built</span><span class="se">\n</span><span class="s2">for speed.&quot;</span>
  <span class="p">},</span>

<span class="c1">//省略输出</span>
<span class="cp">]</span>
</pre></div>


<h2 id="4-markedapi">4. marked的API使用</h2>
<p>接下来，我通过API来调用marked解析markdown文本。</p>
<p>新建一个脚本文件mark1.js</p>
<div class="hlcode"><pre><span class="o">~</span> <span class="n">D</span><span class="o">:</span><span class="err">\</span><span class="n">workspace</span><span class="err">\</span><span class="n">javascript</span><span class="err">\</span><span class="n">nodejs</span><span class="o">-</span><span class="n">marked</span><span class="o">&gt;</span><span class="n">notepad</span> <span class="n">mark1</span><span class="p">.</span><span class="n">js</span>

<span class="n">var</span> <span class="n">marked</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="err">&#39;</span><span class="n">marked</span><span class="err">&#39;</span><span class="p">);</span>
<span class="n">console</span><span class="p">.</span><span class="n">log</span><span class="p">(</span><span class="n">marked</span><span class="p">(</span><span class="err">&#39;</span><span class="n">I</span> <span class="n">am</span> <span class="n">using</span> <span class="n">__markdown__</span><span class="p">.</span><span class="err">&#39;</span><span class="p">));</span>
</pre></div>


<p>运行脚本mark1.js。</p>
<div class="hlcode"><pre><span class="err">~</span> <span class="nb">D</span><span class="p">:</span><span class="o">\</span><span class="nx">workspace</span><span class="o">\</span><span class="nb">javascript</span><span class="o">\</span><span class="nx">nodejs</span><span class="na">-marked</span><span class="o">&gt;</span><span class="nx">node</span> <span class="nx">mark1.js</span>
<span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">I</span> <span class="nb">am</span> <span class="nx">using</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">markdown</span><span class="o">&lt;/</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">.</span><span class="o">&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</pre></div>


<p>下面再用API读取md1.md的文本，进行解析，然后输出为HTML，新建mark2.js文件。</p>
<div class="hlcode"><pre><span class="kd">var</span> <span class="nx">marked</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;marked&#39;</span><span class="p">)</span>
    <span class="p">,</span><span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">)</span>
    <span class="p">,</span><span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;http&#39;</span><span class="p">);</span>

<span class="nx">marked</span><span class="p">.</span><span class="nx">setOptions</span><span class="p">({</span>
    <span class="nx">renderer</span><span class="o">:</span> <span class="k">new</span> <span class="nx">marked</span><span class="p">.</span><span class="nx">Renderer</span><span class="p">(),</span>
    <span class="nx">gfm</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">tables</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">breaks</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">pedantic</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">sanitize</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">smartLists</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">smartypants</span><span class="o">:</span> <span class="kc">false</span>
<span class="p">});</span>

<span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="s1">&#39;m1.md&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
    <span class="nx">server</span><span class="p">(</span><span class="nx">marked</span><span class="p">(</span><span class="nx">data</span><span class="p">));</span>
<span class="p">});</span>

<span class="kd">function</span> <span class="nx">server</span><span class="p">(</span><span class="nx">html</span><span class="p">){</span>
    <span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">writeHead</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/html;charset=utf-8&#39;</span><span class="p">});</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
    <span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">1337</span><span class="p">,</span> <span class="s1">&#39;127.0.0.1&#39;</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Server running at http://127.0.0.1:1337/&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>启动服务</p>
<div class="hlcode"><pre><span class="o">~</span> <span class="n">D</span><span class="o">:</span><span class="err">\</span><span class="n">workspace</span><span class="err">\</span><span class="n">javascript</span><span class="err">\</span><span class="n">nodejs</span><span class="o">-</span><span class="n">marked</span><span class="o">&gt;</span><span class="n">node</span> <span class="n">mark2</span><span class="p">.</span><span class="n">js</span>
<span class="n">Server</span> <span class="n">running</span> <span class="n">at</span> <span class="n">http</span><span class="o">:</span><span class="c1">//127.0.0.1:1337/</span>
</pre></div>


<p>打开浏览器，http://localhost:1337/，m1.md的markdown文本被正确解析为了HTML的网页，链接，文本，段落，表格，列表都被正确显示，我们只需要自定义好样式表就行了。</p>
<p><a href="http://blog.fens.me/wp-content/uploads/2015/02/marked_1.png"><img alt="marked_1" src="http://blog.fens.me/wp-content/uploads/2015/02/marked_1.png" /></a></p>
<h2 id="5-marked">5. marked的个性化渲染使用</h2>
<p>接下来，我们引入bootstrap的样式，修饰一下页面。</p>
<p>修改mark2.js文件的代码。</p>
<div class="hlcode"><pre><span class="nx">fs.readFile</span><span class="p">(</span><span class="s1">&#39;m1.md&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">,</span> <span class="nx">function</span> <span class="p">(</span><span class="nb">err</span><span class="p">,</span> <span class="kd">data</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">//增加HTML的页头</span>
    <span class="kd">var</span> <span class="k">header</span> <span class="o">=</span> <span class="s1">&#39;&lt;!DOCTYPE html&gt;&#39;</span><span class="o">+</span>
        <span class="s1">&#39;&lt;html lang=&quot;zh-CN&quot;&gt;&#39;</span><span class="o">+</span>
        <span class="s1">&#39;&lt;head&gt;&#39;</span><span class="o">+</span>
        <span class="s1">&#39;&lt;title&gt;Marked Demo&lt;/title&gt;&#39;</span><span class="o">+</span>
        <span class="s1">&#39;&lt;link rel=&quot;stylesheet&quot; href=&quot;http://cdn.bootcss.com/bootstrap/3.3.2/css/bootstrap.min.css&quot;&gt;&#39;</span><span class="o">+</span>
        <span class="s1">&#39;&lt;/head&gt;&lt;body&gt;&#39;</span><span class="p">;</span>

    <span class="c1">//增加HTML的页底</span>
    <span class="kd">var</span> <span class="n">footer</span> <span class="o">=</span> <span class="s1">&#39;&lt;script src=&quot;http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="o">+</span>
        <span class="s1">&#39;&lt;script src=&quot;http://cdn.bootcss.com/bootstrap/3.3.2/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;&#39;</span><span class="o">+</span>
        <span class="s1">&#39;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">err</span><span class="p">)</span> <span class="nb">throw</span> <span class="nb">err</span><span class="p">;</span>
    <span class="nx">server</span><span class="p">(</span><span class="k">header</span><span class="o">+</span><span class="nx">marked</span><span class="p">(</span><span class="kd">data</span><span class="p">)</span><span class="o">+</span><span class="nx">footer</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>


<p>渲染页面后，已经好看多了。</p>
<p><a href="http://blog.fens.me/wp-content/uploads/2015/02/marked_2.png"><img alt="marked_2" src="http://blog.fens.me/wp-content/uploads/2015/02/marked_2.png" /></a></p>
<p>但是，美中不足的是表格table，没有样式化。检查bootstrap的表格样式，需要在table的class属性增加table table-striped的样式。</p>
<div class="hlcode"><pre><span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">&quot;table table-striped&quot;</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/table&gt;</span>
</pre></div>


<p>我们在试用marked渲染markdown的过程是自动完成的，现在我们要增加css就需要个性化的渲染，通过API改变渲染的过程。</p>
<p>在代码中增加table的处理，完整的代码如下所示。</p>
<div class="hlcode"><pre><span class="kd">var</span> <span class="n">marked</span> <span class="o">=</span> <span class="k">require</span><span class="err">(&#39;</span><span class="n">marked</span><span class="s1">&#39;)</span>
<span class="s1">    , fs = require(&quot;fs&quot;)</span>
<span class="s1">    ,http = require(&#39;</span><span class="nx">http</span><span class="s1">&#39;);</span>

<span class="s1">marked.setOptions({</span>
<span class="s1">    renderer: new marked.Renderer(),</span>
<span class="s1">    gfm: true,</span>
<span class="s1">    tables: true,</span>
<span class="s1">    breaks: true,</span>
<span class="s1">    pedantic: false,</span>
<span class="s1">    sanitize: true,</span>
<span class="s1">    smartLists: true,</span>
<span class="s1">    smartypants: false</span>
<span class="s1">});</span>

<span class="s1">//增加的代码，用于个性化输出table</span>
<span class="s1">var renderer = new marked.Renderer();</span>
<span class="s1">renderer.table = function (header, body) {</span>
<span class="s1">    return &#39;</span><span class="o">&lt;</span><span class="nb">table</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;table table-striped&quot;</span><span class="o">&gt;</span><span class="s1">&#39;+header+body+&#39;</span><span class="o">&lt;/</span><span class="nb">table</span><span class="o">&gt;</span><span class="s1">&#39;</span>
<span class="s1">}</span>

<span class="s1">fs.readFile(&#39;</span><span class="nx">m1.md</span><span class="s1">&#39;, &#39;</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="s1">&#39;, function (err, data) {</span>
<span class="s1">    var header = &#39;</span><span class="o">&lt;!</span><span class="nb">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span><span class="s1">&#39;+</span>
<span class="s1">        &#39;</span><span class="o">&lt;</span><span class="nx">html</span> <span class="n">lang</span><span class="o">=</span><span class="s2">&quot;zh-CN&quot;</span><span class="o">&gt;</span><span class="s1">&#39;+</span>
<span class="s1">        &#39;</span><span class="o">&lt;</span><span class="nb">head</span><span class="o">&gt;</span><span class="s1">&#39;+</span>
<span class="s1">        &#39;</span><span class="o">&lt;</span><span class="nb">title</span><span class="o">&gt;</span><span class="nx">Marked</span> <span class="nx">Demo</span><span class="o">&lt;/</span><span class="nb">title</span><span class="o">&gt;</span><span class="s1">&#39;+</span>
<span class="s1">        &#39;</span><span class="o">&lt;</span><span class="k">link</span> <span class="n">rel</span><span class="o">=</span><span class="s2">&quot;stylesheet&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;http://cdn.bootcss.com/bootstrap/3.3.2/css/bootstrap.min.css&quot;</span><span class="o">&gt;</span><span class="s1">&#39;+</span>
<span class="s1">        &#39;</span><span class="o">&lt;/</span><span class="nb">head</span><span class="o">&gt;&lt;</span><span class="nb">body</span><span class="o">&gt;</span><span class="s1">&#39;;</span>

<span class="s1">    var footer = &#39;</span><span class="o">&lt;</span><span class="nb">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;http://cdn.bootcss.com/jquery/1.11.2/jquery.min.js&quot;</span><span class="o">&gt;&lt;/</span><span class="nb">script</span><span class="o">&gt;</span><span class="s1">&#39;+</span>
<span class="s1">        &#39;</span><span class="o">&lt;</span><span class="nb">script</span> <span class="n">src</span><span class="o">=</span><span class="s2">&quot;http://cdn.bootcss.com/bootstrap/3.3.2/js/bootstrap.min.js&quot;</span><span class="o">&gt;&lt;/</span><span class="nb">script</span><span class="o">&gt;</span><span class="s1">&#39;+</span>
<span class="s1">        &#39;</span><span class="o">&lt;/</span><span class="nb">body</span><span class="o">&gt;&lt;/</span><span class="nx">html</span><span class="o">&gt;</span><span class="s1">&#39;;</span>

<span class="s1">    if (err) throw err;</span>
<span class="s1">    var body = marked(data,{renderer: renderer});</span>
<span class="s1">    server(header+body+footer);</span>
<span class="s1">});</span>

<span class="s1">function server(html){</span>
<span class="s1">    http.createServer(function (req, res) {</span>
<span class="s1">        res.writeHead(200, {&#39;</span><span class="nb">Content</span><span class="na">-Type</span><span class="s1">&#39;: &#39;</span><span class="nx">text</span><span class="p">/</span><span class="nx">html</span><span class="p">;</span><span class="n">charset</span><span class="o">=</span><span class="nx">utf</span><span class="o">-</span><span class="mi">8</span><span class="s1">&#39;});</span>
<span class="s1">        res.end(html);</span>
<span class="s1">    }).listen(1337, &#39;</span><span class="mf">127.0.0.1</span><span class="s1">&#39;);</span>
<span class="s1">    console.log(&#39;</span><span class="nx">Server</span> <span class="nb">running</span> <span class="nx">at</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//127.0.0.1:1337/&#39;);</span>
<span class="p">}</span>
</pre></div>


<p>再次刷新网页，表格也被友好的显示了。<br />
<a href="http://blog.fens.me/wp-content/uploads/2015/02/marked_3.png"><img alt="marked_3" src="http://blog.fens.me/wp-content/uploads/2015/02/marked_3.png" /></a></p>
<p>这样，我们就完成了对markdown的文档的解析，也可以个性化地设计我们需要的处理样式了。最后，就是把marked库集成到应用中就可以了，其实真的很简单。</p>
    </div>
    <div id="footer">
      <span>
        <p>Copyright © 2020 Tsong khapa.
        Powered by <a href="http://simiki.org/" target="_blank">Simiki</a>.</p>
        <p>Site Generated 2020-10-02 22:54:23</p>
      </span>
    </div>

    
    
  </body>
</html>